<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="theme-color" content="#E8612C">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="EnCollector">
  <title>English Collector</title>
  <link rel="manifest" href="/manifest.json">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <style>
    /* ==================== Variables ==================== */
    :root {
      --cream: #FFFDF7; --card-yellow: #FFF9E6; --card-yellow-hover: #FFF5D6;
      --warm-gray: #F5F3EF; --text-primary: #2D2A26; --text-secondary: #6B665C;
      --text-muted: #A8A299; --accent: #E8612C; --accent-light: #FFEEE8;
      --success: #4CAF50; --error: #E53935; --border: rgba(0,0,0,0.06);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
    html { -webkit-text-size-adjust: 100%; }
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--cream); -webkit-font-smoothing: antialiased;
      min-height: 100vh; overflow-x: hidden; line-height: 1.5;
    }
    .font-serif { font-family: 'Playfair Display', Georgia, serif; }

    /* ==================== Ambient ==================== */
    .ambient-glow { position: fixed; top: -20%; left: -10%; width: 60%; height: 50%; background: radial-gradient(ellipse at center, rgba(255,180,150,0.25) 0%, rgba(255,200,180,0.15) 30%, transparent 70%); pointer-events: none; z-index: 0; }
    .ambient-glow-2 { position: fixed; bottom: -10%; right: -10%; width: 50%; height: 40%; background: radial-gradient(ellipse at center, rgba(200,220,255,0.2) 0%, transparent 70%); pointer-events: none; z-index: 0; }

    /* ==================== Header ==================== */
    .header { position: sticky; top: 0; z-index: 40; padding: 12px 16px; padding-top: max(12px, env(safe-area-inset-top)); background: linear-gradient(to bottom, var(--cream) 80%, transparent); }
    .header-inner { display: flex; align-items: center; gap: 12px; max-width: 1200px; margin: 0 auto; }
    .menu-btn { padding: 8px; margin-left: -8px; background: none; border: none; cursor: pointer; color: var(--text-secondary); border-radius: 8px; }
    .menu-btn:hover { background: var(--warm-gray); }
    .search-box { flex: 1; max-width: 400px; display: flex; align-items: center; padding: 10px 16px; background: white; border: 1px solid var(--border); border-radius: 10px; }
    .search-box input { flex: 1; border: none; background: transparent; font-size: 14px; color: var(--text-primary); outline: none; }
    .search-box input::placeholder { color: var(--text-muted); }
    .add-btn { width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; background: var(--accent); border: none; border-radius: 10px; color: white; cursor: pointer; box-shadow: 0 2px 8px rgba(232,97,44,0.3); }
    .add-btn:hover { background: #D55525; }

    /* ==================== Bottom Nav ==================== */
    .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; z-index: 40; background: rgba(255,253,247,0.95); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border-top: 1px solid var(--border); padding: 4px 0; padding-bottom: max(4px, env(safe-area-inset-bottom)); }
    .nav-items { display: flex; justify-content: space-around; max-width: 500px; margin: 0 auto; }
    .nav-item { display: flex; flex-direction: column; align-items: center; gap: 2px; padding: 6px 12px; background: none; border: none; cursor: pointer; color: var(--text-muted); transition: color 0.2s; }
    .nav-item.active { color: var(--accent); }
    .nav-item:hover { color: var(--text-secondary); }
    .nav-item svg { width: 22px; height: 22px; }
    .nav-item span { font-size: 10px; font-weight: 500; }

    /* ==================== Tab Panels ==================== */
    .tab-panel { position: relative; z-index: 10; padding: 8px 16px 140px; max-width: 1200px; margin: 0 auto; display: none; }
    .tab-panel.active { display: block; }

    /* ==================== Cards & Masonry ==================== */
    .masonry { column-count: 1; column-gap: 12px; }
    @media (min-width: 500px) { .masonry { column-count: 2; } }
    @media (min-width: 800px) { .masonry { column-count: 3; column-gap: 16px; } }
    @media (min-width: 1100px) { .masonry { column-count: 4; } }
    .card { background: var(--card-yellow); border-radius: 8px; transition: all 0.2s ease; box-shadow: 0 1px 2px rgba(0,0,0,0.03); cursor: pointer; padding: 16px; break-inside: avoid; margin-bottom: 12px; }
    .card:hover { background: var(--card-yellow-hover); transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.06); }
    .card-content { font-size: 14px; line-height: 1.6; color: var(--text-primary); display: -webkit-box; -webkit-line-clamp: 4; -webkit-box-orient: vertical; overflow: hidden; }
    .card-keywords { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(0,0,0,0.05); }
    .keyword-tag { font-size: 11px; padding: 3px 8px; background: rgba(232,97,44,0.1); color: var(--accent); border-radius: 4px; }

    /* ==================== Quick Input ==================== */
    .quick-input-wrapper { position: fixed; bottom: 68px; left: 50%; transform: translateX(-50%); width: calc(100% - 32px); max-width: 500px; z-index: 30; padding-bottom: env(safe-area-inset-bottom); }
    .quick-input { background: white; border: 1px solid var(--border); border-radius: 12px; padding: 12px 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
    .quick-input-label { font-size: 11px; font-weight: 500; letter-spacing: 0.5px; color: var(--accent); margin-bottom: 4px; }
    .quick-input input { width: 100%; border: none; background: transparent; font-size: 14px; color: var(--text-primary); outline: none; }

    /* ==================== Empty State ==================== */
    .empty-state { text-align: center; padding: 60px 20px; }
    .empty-state-icon { width: 64px; height: 64px; margin: 0 auto 16px; background: var(--warm-gray); border-radius: 16px; display: flex; align-items: center; justify-content: center; font-size: 28px; }
    .empty-state-title { font-family: 'Playfair Display', serif; font-size: 20px; color: var(--text-primary); margin-bottom: 8px; }
    .empty-state-desc { font-size: 14px; color: var(--text-muted); }

    /* ==================== Sidebar ==================== */
    .sidebar-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.3); z-index: 50; opacity: 0; visibility: hidden; transition: all 0.3s; }
    .sidebar-overlay.active { opacity: 1; visibility: visible; }
    .sidebar { position: fixed; top: 0; left: 0; bottom: 0; width: 280px; background: var(--cream); z-index: 51; transform: translateX(-100%); transition: transform 0.3s ease; display: flex; flex-direction: column; }
    .sidebar.active { transform: translateX(0); }
    .sidebar-header { padding: 20px; border-bottom: 1px solid var(--border); }
    .sidebar-logo { display: flex; align-items: center; gap: 12px; }
    .sidebar-logo-icon { width: 40px; height: 40px; background: var(--accent); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 14px; }
    .sidebar-logo-text { font-family: 'Playfair Display', serif; font-size: 18px; color: var(--text-primary); }
    .sidebar-user { margin-top: 16px; padding: 12px; background: white; border-radius: 10px; display: flex; align-items: center; gap: 10px; cursor: pointer; }
    .sidebar-user:hover { background: var(--warm-gray); }
    .sidebar-user-avatar { width: 36px; height: 36px; border-radius: 50%; background: var(--warm-gray); display: flex; align-items: center; justify-content: center; overflow: hidden; }
    .sidebar-user-avatar img { width: 100%; height: 100%; object-fit: cover; }
    .sidebar-user-info { flex: 1; min-width: 0; }
    .sidebar-user-name { font-size: 13px; font-weight: 500; color: var(--text-primary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .sidebar-user-email { font-size: 11px; color: var(--text-muted); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .sidebar-menu { flex: 1; padding: 12px; overflow-y: auto; }
    .sidebar-menu-item { display: flex; align-items: center; gap: 12px; padding: 12px; border-radius: 8px; color: var(--text-secondary); cursor: pointer; transition: all 0.2s; }
    .sidebar-menu-item:hover { background: var(--warm-gray); }
    .sidebar-menu-item svg { width: 20px; height: 20px; flex-shrink: 0; }
    .sidebar-menu-item span { font-size: 14px; }
    .sidebar-footer { padding: 16px; border-top: 1px solid var(--border); }
    .sync-status { display: flex; align-items: center; gap: 8px; font-size: 12px; color: var(--text-muted); }
    .sync-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--text-muted); }
    .sync-dot.synced { background: var(--success); }
    .sync-dot.syncing { background: #FFC107; animation: pulse 1s infinite; }
    .toggle-row { display: flex; align-items: center; justify-content: space-between; padding: 12px; }
    .toggle-label { font-size: 13px; color: var(--text-secondary); }
    .toggle { position: relative; width: 44px; height: 24px; }
    .toggle input { opacity: 0; width: 0; height: 0; }
    .toggle-slider { position: absolute; cursor: pointer; inset: 0; background: #ccc; border-radius: 24px; transition: 0.3s; }
    .toggle-slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background: white; border-radius: 50%; transition: 0.3s; }
    .toggle input:checked + .toggle-slider { background: var(--accent); }
    .toggle input:checked + .toggle-slider:before { transform: translateX(20px); }

    /* ==================== Modals ==================== */
    .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.15); backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); z-index: 50; display: none; align-items: flex-end; justify-content: center; }
    .modal-overlay.active { display: flex; }
    @media (min-width: 640px) { .modal-overlay { align-items: center; } }
    .modal-content { background: var(--cream); border-radius: 20px 20px 0 0; width: 100%; max-height: 90vh; overflow-y: auto; -webkit-overflow-scrolling: touch; position: relative; }
    @media (min-width: 640px) { .modal-content { max-width: 500px; border-radius: 20px; max-height: 85vh; } }
    .modal-body { padding: 24px; }
    .modal-close { position: absolute; top: 16px; right: 16px; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; background: var(--warm-gray); border: none; border-radius: 50%; cursor: pointer; z-index: 2; }
    .modal-close:hover { background: #E8E6E2; }

    /* ==================== Buttons ==================== */
    .btn { padding: 12px 16px; border: none; border-radius: 10px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s; }
    .btn-secondary { background: var(--warm-gray); color: var(--text-secondary); }
    .btn-secondary:hover { background: #E8E6E2; }
    .btn-primary { background: var(--accent); color: white; }
    .btn-primary:hover { background: #D55525; }
    .btn-primary:disabled { background: var(--text-muted); cursor: not-allowed; }
    .btn-small { padding: 8px 14px; font-size: 13px; border-radius: 8px; }

    /* ==================== Add Modal ==================== */
    .add-modal-title { font-family: 'Playfair Display', serif; font-size: 20px; color: var(--text-primary); margin-bottom: 16px; }
    .add-modal-textarea { width: 100%; height: 120px; padding: 14px; background: white; border: 1px solid rgba(0,0,0,0.08); border-radius: 12px; font-size: 14px; color: var(--text-primary); resize: none; outline: none; line-height: 1.6; font-family: inherit; }
    .add-modal-textarea:focus { border-color: var(--accent); }
    .add-modal-textarea::placeholder { color: var(--text-muted); }
    .add-modal-hint { display: flex; align-items: center; gap: 8px; margin-top: 12px; font-size: 12px; color: var(--text-muted); }
    .add-modal-actions { display: flex; gap: 12px; margin-top: 20px; }
    .add-modal-actions .btn { flex: 1; }

    /* ==================== Detail Modal ==================== */
    .detail-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; }
    .detail-meta { display: flex; align-items: center; gap: 8px; }
    .type-dot { width: 6px; height: 6px; border-radius: 50%; }
    .type-word { background: #E8A87C; } .type-sentence { background: #85B8A0; } .type-paragraph { background: #9B8AA6; }
    .detail-date { font-size: 12px; color: var(--text-muted); }
    .detail-content { font-size: 18px; line-height: 1.6; color: var(--text-primary); font-weight: 300; margin-bottom: 8px; }
    .detail-translation { font-size: 14px; line-height: 1.6; color: var(--text-secondary); padding-bottom: 20px; margin-bottom: 20px; border-bottom: 1px solid var(--border); }
    .keywords-section { margin-bottom: 20px; }
    .keywords-title { display: flex; align-items: center; gap: 8px; margin-bottom: 12px; }
    .keywords-title-bar { width: 3px; height: 14px; background: var(--accent); border-radius: 2px; }
    .keywords-title-text { font-size: 13px; font-weight: 500; color: var(--text-secondary); }
    .keywords-list { display: flex; flex-wrap: wrap; gap: 8px; }
    .keyword-btn { padding: 8px 14px; background: white; border: 1px solid rgba(0,0,0,0.08); border-radius: 8px; font-size: 13px; color: var(--text-primary); cursor: pointer; transition: all 0.2s; }
    .keyword-btn:hover, .keyword-btn.active { background: var(--accent-light); border-color: var(--accent); color: var(--accent); }
    .etymology-box { background: white; border: 1px solid var(--border); border-radius: 12px; padding: 16px; margin-bottom: 20px; }
    .etymology-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px; }
    .etymology-word { font-family: 'Playfair Display', serif; font-size: 22px; color: var(--text-primary); }
    .speak-btn { width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; background: var(--accent-light); border: none; border-radius: 50%; color: var(--accent); cursor: pointer; }
    .speak-btn:hover { background: var(--accent); color: white; }
    .etymology-phonetic { font-size: 14px; color: var(--text-muted); margin-bottom: 12px; }
    .etymology-item { font-size: 13px; margin-bottom: 8px; line-height: 1.5; }
    .etymology-label { color: var(--text-muted); }
    .etymology-value { color: var(--text-secondary); }

    /* ==================== Etymology Tab ==================== */
    .ety-search-box { display: flex; gap: 10px; margin-bottom: 20px; }
    .ety-search-input { flex: 1; padding: 14px 18px; font-size: 15px; background: white; border: 1px solid var(--border); border-radius: 12px; color: var(--text-primary); outline: none; font-family: inherit; }
    .ety-search-input:focus { border-color: var(--accent); }
    .ety-search-input::placeholder { color: var(--text-muted); }
    .ety-search-btn { padding: 14px 24px; font-size: 14px; font-weight: 600; color: white; background: var(--accent); border: none; border-radius: 12px; cursor: pointer; white-space: nowrap; }
    .ety-search-btn:hover { background: #D55525; }
    .ety-search-btn:disabled { background: var(--text-muted); }

    .ety-sub-nav { display: flex; gap: 6px; margin-bottom: 20px; flex-wrap: wrap; }
    .ety-sub-btn { padding: 8px 16px; font-size: 13px; font-weight: 500; background: white; border: 1px solid var(--border); border-radius: 20px; color: var(--text-secondary); cursor: pointer; transition: all 0.2s; }
    .ety-sub-btn.active { background: var(--accent); color: white; border-color: var(--accent); }
    .ety-sub-btn:hover:not(.active) { background: var(--warm-gray); }

    /* Result card */
    .ety-result { animation: fadeIn 0.3s ease; }
    .ety-result-header { background: white; border: 1px solid var(--border); border-radius: 16px; padding: 24px; margin-bottom: 16px; }
    .ety-result-word { font-family: 'Playfair Display', serif; font-size: 32px; color: var(--text-primary); }
    .ety-result-phonetic { font-size: 15px; color: var(--text-muted); margin: 4px 0 8px; }
    .ety-result-meaning { font-size: 16px; color: var(--text-secondary); line-height: 1.6; }
    .ety-result-actions { display: flex; gap: 10px; margin-top: 12px; flex-wrap: wrap; }

    .ety-card { background: white; border: 1px solid var(--border); border-radius: 14px; padding: 20px; margin-bottom: 14px; }
    .ety-card-title { display: flex; align-items: center; gap: 8px; font-size: 14px; font-weight: 600; color: var(--text-primary); margin-bottom: 14px; }
    .ety-root-item { display: flex; align-items: center; flex-wrap: wrap; gap: 8px; padding: 10px 12px; background: var(--warm-gray); border-radius: 10px; margin-bottom: 8px; }
    .ety-root-part { padding: 4px 10px; font-size: 13px; font-weight: 700; color: var(--accent); background: var(--accent-light); border-radius: 6px; font-family: monospace; }
    .ety-root-origin { font-size: 11px; color: var(--text-muted); padding: 2px 6px; background: white; border-radius: 4px; }
    .ety-root-meaning { font-size: 13px; color: var(--text-secondary); }
    .ety-story { font-size: 14px; color: var(--text-secondary); line-height: 1.8; }
    .ety-memory-tip { padding: 12px; font-size: 13px; color: #B8860B; background: #FFF8DC; border-radius: 10px; border: 1px solid #F0E68C; margin-top: 12px; }
    .ety-example { padding: 12px 0; border-bottom: 1px solid var(--border); }
    .ety-example:last-child { border-bottom: none; }
    .ety-example-en { font-size: 14px; color: var(--text-primary); line-height: 1.5; display: flex; align-items: flex-start; gap: 8px; }
    .ety-example-cn { font-size: 13px; color: var(--text-muted); padding-left: 30px; margin-top: 4px; }
    .ety-related { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 16px; }
    .ety-related-tag { padding: 6px 14px; font-size: 13px; color: var(--accent); background: var(--accent-light); border: 1px solid rgba(232,97,44,0.2); border-radius: 20px; cursor: pointer; transition: all 0.2s; }
    .ety-related-tag:hover { background: var(--accent); color: white; }

    /* Categories grid */
    .cat-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 12px; margin-bottom: 24px; }
    .cat-card { padding: 18px 14px; display: flex; flex-direction: column; align-items: center; gap: 8px; background: white; border-radius: 14px; border: 2px solid var(--border); cursor: pointer; transition: all 0.2s; text-align: center; }
    .cat-card:hover { border-color: var(--accent); transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.06); }
    .cat-icon { font-size: 32px; }
    .cat-name { font-size: 14px; font-weight: 600; color: var(--text-primary); }
    .cat-count { font-size: 11px; color: var(--text-muted); }

    /* Course */
    .level-tabs { display: flex; gap: 8px; margin-bottom: 16px; flex-wrap: wrap; }
    .level-tab { padding: 10px 18px; font-size: 13px; font-weight: 500; background: white; border: 1px solid var(--border); border-radius: 10px; cursor: pointer; color: var(--text-secondary); }
    .level-tab.active { background: var(--accent); color: white; border-color: var(--accent); }
    .unit-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 14px; }
    .unit-card { background: white; border: 1px solid var(--border); border-radius: 14px; padding: 20px; }
    .unit-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
    .unit-number { font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; }
    .unit-badge { padding: 3px 8px; font-size: 11px; font-weight: 600; color: var(--success); background: rgba(76,175,80,0.1); border-radius: 8px; }
    .unit-title { font-size: 16px; font-weight: 600; color: var(--text-primary); margin-bottom: 4px; }
    .unit-subtitle { font-size: 12px; color: var(--text-muted); margin-bottom: 12px; font-family: monospace; }
    .unit-stats { display: flex; gap: 14px; font-size: 12px; color: var(--text-muted); margin-bottom: 14px; }
    .unit-actions { display: flex; gap: 8px; }
    .unit-actions .btn { flex: 1; text-align: center; }

    /* Word list */
    .word-list { display: flex; flex-direction: column; gap: 6px; }
    .word-list-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; background: var(--warm-gray); border-radius: 10px; cursor: pointer; transition: all 0.2s; }
    .word-list-item:hover { background: var(--accent-light); }
    .word-list-item span:first-child { font-size: 14px; color: var(--text-primary); font-weight: 500; }
    .word-list-item span:last-child { font-size: 13px; color: var(--text-muted); }

    /* Daily article */
    .daily-article { background: white; border: 1px solid var(--border); border-radius: 16px; padding: 24px; margin-bottom: 20px; }
    .article-badge { padding: 4px 10px; font-size: 12px; font-weight: 600; color: #B8860B; background: #FFF8DC; border-radius: 8px; display: inline-block; margin-bottom: 12px; }
    .article-title { font-family: 'Playfair Display', serif; font-size: 20px; color: var(--text-primary); margin-bottom: 12px; }
    .article-content { font-size: 14px; color: var(--text-secondary); line-height: 1.8; white-space: pre-line; margin-bottom: 16px; }
    .article-roots { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 16px; }
    .article-root-tag { padding: 5px 12px; font-size: 13px; color: var(--accent); background: var(--accent-light); border-radius: 8px; font-family: monospace; }
    .article-examples { display: flex; gap: 10px; flex-wrap: wrap; }
    .article-word-btn { padding: 10px 16px; background: var(--warm-gray); border: none; border-radius: 10px; cursor: pointer; text-align: left; transition: all 0.2s; }
    .article-word-btn:hover { background: var(--accent-light); }
    .article-word-text { font-size: 15px; font-weight: 600; color: var(--accent); display: block; }
    .article-word-meaning { font-size: 12px; color: var(--text-muted); display: block; margin-top: 2px; }

    /* ==================== Review Tab ==================== */
    .review-container { text-align: center; max-width: 500px; margin: 0 auto; padding-top: 20px; }
    .flashcard { perspective: 1000px; width: 100%; max-width: 360px; height: 240px; margin: 0 auto 24px; cursor: pointer; }
    .flashcard-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s; transform-style: preserve-3d; }
    .flashcard.flipped .flashcard-inner { transform: rotateY(180deg); }
    .flashcard-front, .flashcard-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; -webkit-backface-visibility: hidden; background: var(--card-yellow); border-radius: 16px; padding: 24px; display: flex; flex-direction: column; justify-content: center; align-items: center; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
    .flashcard-back { transform: rotateY(180deg); text-align: left; justify-content: flex-start; align-items: stretch; overflow-y: auto; }
    .flashcard-word { font-family: 'Playfair Display', serif; font-size: 28px; color: var(--text-primary); margin-bottom: 8px; }
    .flashcard-phonetic { font-size: 15px; color: var(--text-muted); margin-bottom: 12px; }
    .flashcard-speak { width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; background: white; border: 1px solid var(--border); border-radius: 50%; color: var(--accent); cursor: pointer; font-size: 18px; }
    .flashcard-speak:hover { background: var(--accent); color: white; }
    .flashcard-back-word { font-family: 'Playfair Display', serif; font-size: 20px; color: var(--text-primary); margin-bottom: 4px; }
    .flashcard-back-meaning { font-size: 15px; color: var(--text-primary); margin-bottom: 10px; font-weight: 500; }
    .flashcard-back-detail { font-size: 12px; color: var(--text-secondary); line-height: 1.5; }
    .flashcard-back-detail span { color: var(--text-muted); }
    .review-stats { display: flex; justify-content: space-around; padding: 14px 16px; margin: 0 16px 16px; background: white; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
    .review-stat-item { text-align: center; }
    .review-stat-num { font-family: 'Playfair Display', serif; font-size: 24px; font-weight: 600; color: var(--text-primary); }
    .review-stat-label { font-size: 11px; color: var(--text-muted); margin-top: 2px; }
    .review-history-item { display: flex; align-items: center; gap: 12px; padding: 12px; background: white; border-radius: 10px; margin-bottom: 8px; }
    .review-history-word { font-size: 15px; font-weight: 500; color: var(--text-primary); flex: 1; }
    .review-level-badge { font-size: 11px; padding: 3px 8px; border-radius: 10px; font-weight: 500; }
    .review-level-0 { background: #f3f4f6; color: #6b7280; }
    .review-level-1 { background: #fee2e2; color: #dc2626; }
    .review-level-2 { background: #fef3c7; color: #d97706; }
    .review-level-3 { background: #dbeafe; color: #2563eb; }
    .review-level-4 { background: #d1fae5; color: #059669; }
    .review-level-5 { background: #dcfce7; color: #16a34a; }
    .review-actions { display: flex; gap: 16px; justify-content: center; }
    .review-btn { padding: 12px 28px; border: none; border-radius: 10px; font-size: 14px; font-weight: 500; cursor: pointer; }
    .review-btn.know { background: var(--success); color: white; }
    .review-btn.dont-know { background: #FF7043; color: white; }
    .review-progress { font-size: 13px; color: var(--text-muted); margin-bottom: 12px; }
    .review-hint { font-size: 12px; color: var(--text-muted); margin-bottom: 16px; }

    /* ==================== Settings ==================== */
    .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 24px; }
    .stat-card { background: white; border-radius: 12px; padding: 14px 10px; text-align: center; }
    .stat-value { font-family: 'Playfair Display', serif; font-size: 26px; color: var(--text-primary); }
    .stat-label { font-size: 10px; color: var(--text-muted); margin-top: 2px; }
    .settings-section { margin-bottom: 24px; }
    .settings-title { font-size: 11px; font-weight: 500; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 10px; }
    .settings-card { background: white; border-radius: 12px; overflow: hidden; }
    .settings-item { display: flex; align-items: center; justify-content: space-between; padding: 14px 16px; border-bottom: 1px solid rgba(0,0,0,0.05); }
    .settings-item:last-child { border-bottom: none; }
    .settings-item-label { font-size: 14px; color: var(--text-primary); }
    .settings-item-value { font-size: 13px; color: var(--text-muted); }
    .settings-input { padding: 8px 12px; border: 1px solid rgba(0,0,0,0.1); border-radius: 8px; font-size: 13px; width: 160px; text-align: right; outline: none; }
    .settings-input:focus { border-color: var(--accent); }
    .settings-select { padding: 8px 12px; border: 1px solid rgba(0,0,0,0.1); border-radius: 8px; font-size: 13px; background: white; min-width: 140px; outline: none; }

    /* ==================== Toast & Spinner ==================== */
    .spinner { width: 18px; height: 18px; border: 2px solid rgba(255,255,255,0.3); border-top-color: white; border-radius: 50%; animation: spin 0.8s linear infinite; margin: 0 auto; }
    .spinner-dark { border-color: rgba(0,0,0,0.1); border-top-color: var(--accent); }
    @keyframes spin { to { transform: rotate(360deg); } }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .toast { position: fixed; top: 20px; top: max(20px, env(safe-area-inset-top)); left: 50%; transform: translateX(-50%) translateY(-100px); background: var(--text-primary); color: white; padding: 12px 20px; border-radius: 10px; font-size: 14px; z-index: 100; transition: transform 0.3s ease; max-width: 90%; text-align: center; }
    .toast.show { transform: translateX(-50%) translateY(0); }
    .toast.error { background: var(--error); }
    .toast.success { background: var(--success); }
    .hide { display: none !important; }
    
    /* Welcome animation */
    .welcome-overlay { position:fixed; inset:0; z-index:9999; background:var(--cream); display:flex; flex-direction:column; align-items:center; justify-content:center; transition: opacity 0.8s ease; }
    .welcome-overlay.fade-out { opacity:0; pointer-events:none; }
    .welcome-circle { width:120px; height:120px; border-radius:50%; background: linear-gradient(135deg, #E8612C 0%, #F4845F 50%, #FFB088 100%); animation: breathe 3s ease-in-out infinite; box-shadow: 0 0 60px rgba(232,97,44,0.3); display:flex; align-items:center; justify-content:center; }
    .welcome-circle-inner { width:40px; height:40px; border-radius:50%; background: rgba(255,255,255,0.3); animation: breathe-inner 3s ease-in-out infinite; }
    .welcome-eyes { position:absolute; display:flex; gap:18px; margin-top:-14px; }
    .welcome-eye { width:8px; height:10px; background:white; border-radius:50%; animation: blink 3s ease-in-out infinite; }
    .welcome-mouth { position:absolute; margin-top:14px; width:20px; height:10px; border-bottom:3px solid white; border-radius:0 0 20px 20px; }
    .welcome-text { margin-top:32px; font-family:'Playfair Display',serif; font-size:28px; color:var(--text-primary); opacity:0; animation: fadeUp 1s ease 0.5s forwards; }
    .welcome-sub { margin-top:8px; font-size:14px; color:var(--text-muted); opacity:0; animation: fadeUp 1s ease 1s forwards; }
    @keyframes breathe { 0%,100% { transform:scale(1); } 50% { transform:scale(1.15); } }
    @keyframes breathe-inner { 0%,100% { transform:scale(1); opacity:0.3; } 50% { transform:scale(1.3); opacity:0.5; } }
    @keyframes blink { 0%,42%,50%,100% { transform:scaleY(1); } 45% { transform:scaleY(0.1); } }
    @keyframes fadeUp { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }
    
    /* Date group headers */
    .date-group-header { padding:8px 4px 6px; margin-top:8px; display:flex; align-items:center; gap:8px; }
    .date-group-dot { width:6px; height:6px; border-radius:50%; background:var(--accent); }
    .date-group-label { font-size:12px; font-weight:500; color:var(--text-muted); letter-spacing:0.3px; }
    .date-group-count { font-size:11px; color:var(--text-muted); opacity:0.6; }
    
    /* Article favorite */
    .article-fav-btn { padding:6px 14px; font-size:13px; background:white; border:1px solid rgba(0,0,0,0.08); border-radius:8px; cursor:pointer; transition:all 0.2s; display:flex; align-items:center; gap:4px; }
    .article-fav-btn.faved { background:var(--accent-light); border-color:rgba(232,97,44,0.2); color:var(--accent); }
    .article-fav-btn:hover { background:var(--accent-light); }
    .fav-articles-toggle { padding:8px 14px; font-size:12px; color:var(--accent); background:var(--accent-light); border:1px solid rgba(232,97,44,0.15); border-radius:8px; cursor:pointer; margin-bottom:12px; }
    .fav-article-card { padding:14px; background:white; border:1px solid rgba(0,0,0,0.06); border-radius:10px; margin-bottom:8px; cursor:pointer; transition:all 0.2s; }
    .fav-article-card:hover { background:var(--card-yellow); }
  </style>
</head>
<body>
  <div class="ambient-glow"></div>
  <div class="ambient-glow-2"></div>
  <div id="toast" class="toast"></div>

  <!-- Welcome Animation -->
  <div class="welcome-overlay" id="welcomeOverlay">
    <div class="welcome-circle" style="position:relative">
      <div class="welcome-eyes"><div class="welcome-eye"></div><div class="welcome-eye"></div></div>
      <div class="welcome-mouth"></div>
    </div>
    <div class="welcome-text">Hello, World ‚ú¶</div>
    <div class="welcome-sub" id="welcomeSub">Ready to explore words today?</div>
  </div>

  <!-- ==================== Sidebar ==================== -->
  <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>
  <div class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="sidebar-logo">
        <div class="sidebar-logo-icon">En</div>
        <div class="sidebar-logo-text">English Collector</div>
      </div>
      <div class="sidebar-user" id="sidebarUser" onclick="handleGoogleAuth()">
        <div class="sidebar-user-avatar" id="userAvatar">
          <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"/></svg>
        </div>
        <div class="sidebar-user-info">
          <div class="sidebar-user-name" id="userName">Êú™ÁôªÂΩï</div>
          <div class="sidebar-user-email" id="userEmail">ÁÇπÂáªÁôªÂΩï Google ÂêåÊ≠•</div>
        </div>
      </div>
    </div>
    <div class="sidebar-menu">
      <div class="toggle-row">
        <span class="toggle-label">Ëá™Âä®ÂêåÊ≠•</span>
        <label class="toggle"><input type="checkbox" id="autoSyncToggle" onchange="toggleAutoSync()"><span class="toggle-slider"></span></label>
      </div>
      <div class="sidebar-menu-item" onclick="manualSync()">
        <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99"/></svg>
        <span>Á´ãÂç≥ÂêåÊ≠•</span>
      </div>
      <div class="sidebar-menu-item" onclick="syncFromCloud()">
        <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9.75v6.75m0 0l-3-3m3 3l3-3m-8.25 6a4.5 4.5 0 01-1.41-8.775 5.25 5.25 0 0110.233-2.33 3 3 0 013.758 3.848A3.752 3.752 0 0118 19.5H6.75z"/></svg>
        <span>‰ªé‰∫ëÁ´ØÊÅ¢Â§ç</span>
      </div>
    </div>
    <div class="sidebar-footer">
      <div class="sync-status"><div class="sync-dot" id="syncDot"></div><span id="syncStatusText">Êú¨Âú∞Â≠òÂÇ®</span></div>
    </div>
  </div>

  <!-- ==================== Header ==================== -->
  <header class="header" id="mainHeader">
    <div class="header-inner">
      <button class="menu-btn" onclick="openSidebar()">
        <svg width="22" height="22" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"/></svg>
      </button>
      <div class="search-box">
        <input type="text" id="searchInput" placeholder="ÊêúÁ¥¢Êî∂ËóèÂÜÖÂÆπ..." oninput="handleSearch()">
      </div>
      <button class="menu-btn" id="viewToggleBtn" onclick="toggleTimelineView()" title="ÂàáÊç¢ËßÜÂõæ">
        <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 5.25h16.5m-16.5 4.5h16.5m-16.5 4.5h16.5m-16.5 4.5h16.5"/></svg>
      </button>
      <button class="add-btn" onclick="openAddModal()">
        <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/></svg>
      </button>
    </div>
  </header>

  <!-- ==================== Tab 1: Collection ==================== -->
  <div class="tab-panel active" id="tabCollection">
    <div class="masonry" id="cardGrid"></div>
    <div class="empty-state hide" id="emptyState">
      <div class="empty-state-icon">üìù</div>
      <h2 class="empty-state-title">Your mind is empty</h2>
      <p class="empty-state-desc">Start collecting words and sentences</p>
    </div>
  </div>

  <!-- ==================== Tab 2: Etymology ==================== -->
  <div class="tab-panel" id="tabEtymology">
    <!-- Search -->
    <div class="ety-search-box">
      <input class="ety-search-input" id="etySearchInput" placeholder="ËæìÂÖ•Ëã±ÊñáÂçïËØçÔºåÊé¢Á¥¢ËØçÊ∫ê..." onkeydown="if(event.key==='Enter')etySearch()">
      <button class="ety-search-btn" id="etySearchBtn" onclick="etySearch()">Ëß£Êûê</button>
    </div>
    <!-- Sub navigation -->
    <div class="ety-sub-nav">
      <button class="ety-sub-btn active" data-view="search" onclick="switchEtyView('search')">üîç ÊêúÁ¥¢</button>
      <button class="ety-sub-btn" data-view="explore" onclick="switchEtyView('explore')">üó∫Ô∏è Êé¢Á¥¢</button>
      <button class="ety-sub-btn" data-view="course" onclick="switchEtyView('course')">üìñ ËØæÁ®ã</button>
    </div>
    <!-- Content areas -->
    <div id="etySearchView"></div>
    <div id="etyExploreView" class="hide"></div>
    <div id="etyCourseView" class="hide"></div>
  </div>

  <!-- ==================== Tab 3: Review ==================== -->
  <div class="tab-panel" id="tabReview">
    <!-- Review Stats -->
    <div class="review-stats" id="reviewStats">
      <div class="review-stat-item"><div class="review-stat-num" id="reviewDueCount" style="color:var(--accent)">0</div><div class="review-stat-label">ÂæÖÂ§ç‰π†</div></div>
      <div class="review-stat-item"><div class="review-stat-num" id="reviewNewCount" style="color:#3b82f6">0</div><div class="review-stat-label">Êñ∞ËØç</div></div>
      <div class="review-stat-item"><div class="review-stat-num" id="reviewMasteredCount" style="color:var(--success)">0</div><div class="review-stat-label">Â∑≤ÊéåÊè°</div></div>
      <div class="review-stat-item"><div class="review-stat-num" id="reviewTotalCount">0</div><div class="review-stat-label">ÊÄªËØçÊ±á</div></div>
    </div>
    <!-- Review Session -->
    <div class="review-container" id="reviewContent">
      <p class="review-progress" id="reviewProgress">1 / 20</p>
      <p class="review-hint">ÁÇπÂáªÂç°ÁâáÁøªËΩ¨ÔºåÁÇπÂáª üîä Âê¨ÂèëÈü≥</p>
      <div class="flashcard" id="flashcard" onclick="flipCard()">
        <div class="flashcard-inner">
          <div class="flashcard-front">
            <div class="flashcard-word" id="flashcardWord">word</div>
            <div class="flashcard-phonetic" id="flashcardPhonetic">/w…úÀêrd/</div>
            <button class="flashcard-speak" onclick="event.stopPropagation();speakWord(document.getElementById('flashcardWord').textContent)">üîä</button>
          </div>
          <div class="flashcard-back" id="flashcardBack"></div>
        </div>
      </div>
      <div class="review-actions">
        <button class="review-btn dont-know" onclick="markCard(false)">‰∏çËÆ§ËØÜ</button>
        <button class="review-btn know" onclick="markCard(true)">ËÆ§ËØÜ</button>
      </div>
    </div>
    <!-- Session Summary -->
    <div id="reviewSummary" class="hide" style="padding:30px 20px;text-align:center;max-width:400px;margin:0 auto">
      <div style="font-size:48px;margin-bottom:12px" id="summaryEmoji">üéâ</div>
      <h3 style="font-size:20px;font-weight:600;color:var(--text-primary);margin-bottom:8px" id="summaryTitle">Â§ç‰π†ÂÆåÊàêÔºÅ</h3>
      <p style="font-size:14px;color:var(--text-secondary);margin-bottom:20px" id="summaryText"></p>
      <div style="display:flex;gap:12px;justify-content:center">
        <button class="btn btn-secondary" onclick="showReviewHistory()" style="flex:none;padding:10px 20px">Êü•ÁúãËÆ∞ÂΩï</button>
        <button class="btn btn-primary" onclick="initReview()" style="flex:none;padding:10px 20px">ÁªßÁª≠Â§ç‰π†</button>
      </div>
    </div>
    <!-- Empty State -->
    <div id="reviewEmpty" class="hide">
      <div class="empty-state">
        <div class="empty-state-icon">üé¥</div>
        <h2 class="empty-state-title">Ê≤°ÊúâÂèØÂ§ç‰π†ÁöÑÂçïËØç</h2>
        <p class="empty-state-desc">ÂÖàÂéªÊî∂Ëóè‰∏Ä‰∫õÂÜÖÂÆπÊàñÂ≠¶‰π†ËØçÊ†πÂêß</p>
      </div>
    </div>
    <!-- Review History Modal -->
    <div id="reviewHistoryPanel" class="hide" style="padding:0 16px 80px;max-width:500px;margin:0 auto">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px">
        <h3 style="font-size:16px;font-weight:600;color:var(--text-primary);margin:0">Â§ç‰π†ËÆ∞ÂΩï</h3>
        <button class="btn btn-secondary" onclick="closeReviewHistory()" style="padding:6px 14px;font-size:12px">ËøîÂõû</button>
      </div>
      <div id="reviewHistoryList"></div>
    </div>
  </div>

  <!-- ==================== Tab 4: Settings ==================== -->
  <div class="tab-panel" id="tabSettings">
    <div class="stats-grid">
      <div class="stat-card"><div class="stat-value" id="statTotal">0</div><div class="stat-label">Êî∂Ëóè</div></div>
      <div class="stat-card"><div class="stat-value" id="statWords">0</div><div class="stat-label">ËØçÊ±á</div></div>
      <div class="stat-card"><div class="stat-value" id="statEtyCount">0</div><div class="stat-label">ËØçÊ∫ê</div></div>
      <div class="stat-card"><div class="stat-value" id="statDays">0</div><div class="stat-label">Â§©Êï∞</div></div>
    </div>
    <div class="settings-section">
      <div class="settings-title">AI ËÆæÁΩÆ</div>
      <div class="settings-card">
        <div class="settings-item">
          <span class="settings-item-label">ÊúçÂä°ÂïÜ</span>
          <select class="settings-select" id="apiProvider" onchange="onProviderChange()">
            <option value="gemini">GeminiÔºàÂÖçË¥πÔºâ</option>
            <option value="openrouter">OpenRouter (Claude)</option>
            <option value="deepseek">DeepSeek</option>
          </select>
        </div>
        <div class="settings-item">
          <span class="settings-item-label">Ê®°Âûã</span>
          <select class="settings-select" id="apiModel" onchange="saveSettings()"></select>
        </div>
        <div class="settings-item">
          <span class="settings-item-label">API Key</span>
          <input type="password" class="settings-input" id="apiKey" placeholder="ËæìÂÖ• API Key" onchange="saveSettings()">
        </div>
      </div>
    </div>
    <div class="settings-section">
      <div class="settings-title">Êï∞ÊçÆÁÆ°ÁêÜ</div>
      <div class="settings-card">
        <div class="settings-item" style="cursor:pointer" onclick="exportJSON()">
          <span class="settings-item-label">ÂØºÂá∫Â§á‰ªΩ (JSON)</span>
          <span class="settings-item-value">‚Üì</span>
        </div>
        <div class="settings-item" style="cursor:pointer" onclick="document.getElementById('importFile').click()">
          <span class="settings-item-label">ÂØºÂÖ•Â§á‰ªΩ</span>
          <span class="settings-item-value">‚Üë</span>
          <input type="file" id="importFile" accept=".json" style="display:none" onchange="importJSON(event)">
        </div>
        <div class="settings-item" style="cursor:pointer" onclick="exportAnki()">
          <span class="settings-item-label">ÂØºÂá∫Âà∞ Anki</span>
          <span class="settings-item-value">‚Üì</span>
        </div>
      </div>
    </div>
    <div class="settings-section">
      <div class="settings-title">ÂÖ≥‰∫é</div>
      <div class="settings-card">
        <div class="settings-item"><span class="settings-item-label">ÁâàÊú¨</span><span class="settings-item-value">2.0.0</span></div>
      </div>
    </div>
  </div>

  <!-- ==================== Quick Input (Collection tab only) ==================== -->
  <div class="quick-input-wrapper" id="quickInputWrapper">
    <div class="quick-input">
      <div class="quick-input-label">Ê∑ªÂä†Êñ∞ÂÜÖÂÆπ</div>
      <input type="text" id="quickInput" placeholder="ËæìÂÖ•Ëã±ÊñáÂÜÖÂÆπ..." onkeydown="handleQuickInput(event)">
    </div>
  </div>

  <!-- ==================== Bottom Nav ==================== -->
  <nav class="bottom-nav">
    <div class="nav-items">
      <button class="nav-item active" data-tab="collection" onclick="switchTab('collection')">
        <svg fill="currentColor" viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7" rx="1.5"/><rect x="14" y="3" width="7" height="7" rx="1.5"/><rect x="3" y="14" width="7" height="7" rx="1.5"/><rect x="14" y="14" width="7" height="7" rx="1.5"/></svg>
        <span>Êî∂Ëóè</span>
      </button>
      <button class="nav-item" data-tab="etymology" onclick="switchTab('etymology')">
        <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25"/></svg>
        <span>ËØçÊ†π</span>
      </button>
      <button class="nav-item" data-tab="review" onclick="switchTab('review')">
        <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M4.26 10.147a60.436 60.436 0 00-.491 6.347A48.627 48.627 0 0112 20.904a48.627 48.627 0 018.232-4.41 60.46 60.46 0 00-.491-6.347m-15.482 0a50.57 50.57 0 00-2.658-.813A59.905 59.905 0 0112 3.493a59.902 59.902 0 0110.399 5.84c-.896.248-1.783.52-2.658.814m-15.482 0A50.697 50.697 0 0112 13.489a50.702 50.702 0 017.74-3.342M6.75 15a.75.75 0 100-1.5.75.75 0 000 1.5zm0 0v-3.675A55.378 55.378 0 0112 8.443m-7.007 11.55A5.981 5.981 0 006.75 15.75v-1.5"/></svg>
        <span>Â§ç‰π†</span>
      </button>
      <button class="nav-item" data-tab="settings" onclick="switchTab('settings')">
        <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z"/><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
        <span>ËÆæÁΩÆ</span>
      </button>
    </div>
  </nav>

  <!-- ==================== Add Modal ==================== -->
  <div class="modal-overlay" id="addModal" onclick="closeAddModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div class="modal-body">
        <h2 class="add-modal-title">Save to your mind</h2>
        <textarea class="add-modal-textarea" id="addInput" placeholder="Á≤òË¥¥ÊàñËæìÂÖ•Ëã±ÊñáÂÜÖÂÆπ..."></textarea>
        <div class="add-modal-hint">
          <span>‚ú® AI Â∞ÜËá™Âä®ÂàÜÊûêÂπ∂ÊèêÂèñÈáçÁÇπËØçÊ±á</span>
        </div>
        <div class="add-modal-actions">
          <button class="btn btn-secondary" onclick="closeAddModal()">ÂèñÊ∂à</button>
          <button class="btn btn-primary" id="saveBtn" onclick="saveCard()"><span id="saveBtnText">‰øùÂ≠ò</span></button>
        </div>
      </div>
    </div>
  </div>

  <!-- ==================== Detail Modal ==================== -->
  <div class="modal-overlay" id="detailModal" onclick="closeDetailModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div class="modal-body" id="detailBody"></div>
    </div>
  </div>

<script>
// ======================================================================
// CONFIG & DATA
// ======================================================================
const GOOGLE_CLIENT_ID = '550666764387-5tofkeq6i4r9a8n15i50rfrgikdeinp6.apps.googleusercontent.com';
const DRIVE_FILE_NAME = 'english-collector-backup.json';

// ==================== EXPANDED DATA ====================

const EXPLORE_CATEGORIES = [
  { id: 'film', icon: 'üé¨', name: 'ÂΩ±ËßÜÁºñÂâß', color: '#f43f5e', keywords: ['screenplay','protagonist','antagonist','cinematography','montage','denouement','narrative','dialogue','subplot','exposition','climax','resolution','storyboard','voiceover','mise-en-sc√®ne'] },
  { id: 'law', icon: '‚öñÔ∏è', name: 'Ê≥ïÂæã', color: '#8b5cf6', keywords: ['jurisdiction','litigation','plaintiff','defendant','testimony','verdict','prosecution','acquittal','statute','precedent','liability','injunction','subpoena','affidavit','deposition'] },
  { id: 'medical', icon: 'üíä', name: 'ÂåªÂ≠¶', color: '#10b981', keywords: ['diagnosis','prognosis','pathology','syndrome','chronic','acute','benign','malignant','inflammation','antibiotic','cardiovascular','neurological','immunology','metabolism','biopsy'] },
  { id: 'finance', icon: 'üí∞', name: 'ÈáëËûçÊäïËµÑ', color: '#f59e0b', keywords: ['portfolio','dividend','equity','liability','liquidity','amortization','appreciation','depreciation','derivative','hedge','arbitrage','leverage','collateral','fiduciary','insolvency'] },
  { id: 'tech', icon: 'üíª', name: 'ËÆ°ÁÆóÊú∫ÁßëÊäÄ', color: '#3b82f6', keywords: ['algorithm','encryption','protocol','bandwidth','latency','synchronous','asynchronous','repository','compiler','recursion','polymorphism','virtualization','authentication','deprecated','iteration'] },
  { id: 'biology', icon: 'üß¨', name: 'ÁîüÁâ©ÁßëÂ≠¶', color: '#14b8a6', keywords: ['photosynthesis','mitochondria','chromosome','genome','enzyme','organism','cellular','mutation','symbiosis','metabolism','prokaryote','eukaryote','homeostasis','phylogeny','biodiversity'] },
  { id: 'psychology', icon: 'üß†', name: 'ÂøÉÁêÜÂ≠¶', color: '#ec4899', keywords: ['cognition','perception','consciousness','subconscious','neurosis','psychosis','empathy','introspection','behaviorism','conditioning','reinforcement','catharsis','projection','repression','transference'] },
  { id: 'architecture', icon: 'üèõÔ∏è', name: 'Âª∫Á≠ëÂ≠¶', color: '#78716c', keywords: ['facade','buttress','cantilever','colonnade','cornice','edifice','foundation','lintel','masonry','pediment','portico','renovation','symmetry','vault','vestibule'] },
  { id: 'astronomy', icon: 'üî≠', name: 'Â§©ÊñáÂ≠¶', color: '#6366f1', keywords: ['asteroid','constellation','eclipse','galaxy','nebula','orbit','parallax','perihelion','pulsar','quasar','satellite','solstice','supernova','telescope','zenith'] },
  { id: 'philosophy', icon: 'üí≠', name: 'Âì≤Â≠¶', color: '#a855f7', keywords: ['aesthetics','altruism','dialectic','empiricism','epistemology','existential','metaphysics','nihilism','ontology','paradigm','pragmatism','skepticism','stoicism','syllogism','transcendent'] },
  { id: 'cuisine', icon: 'üç≥', name: 'ÁÉπÈ•™ÁæéÈ£ü', color: '#ea580c', keywords: ['blanch','braise','caramelize','deglaze','emulsify','ferment','garnish','julienne','marinate','poach','reduction','saut√©','simmer','tempering','vinaigrette'] },
  { id: 'music', icon: 'üéµ', name: 'Èü≥‰πê', color: '#e11d48', keywords: ['allegro','aria','cadence','chord','crescendo','harmony','melody','octave','orchestra','overture','resonance','rhythm','sonata','symphony','tempo'] },
  { id: 'maritime', icon: '‚öì', name: 'Ëà™Êµ∑', color: '#0891b2', keywords: ['archipelago','beacon','buoyancy','compass','current','harbor','latitude','longitude','maritime','nautical','navigation','peninsula','starboard','strait','voyage'] },
  { id: 'environment', icon: 'üåç', name: 'ÁéØÂ¢ÉÁßëÂ≠¶', color: '#16a34a', keywords: ['atmosphere','biosphere','conservation','deforestation','ecosystem','emission','erosion','greenhouse','habitat','ozone','pollution','renewable','sustainability','watershed','wetland'] },
  { id: 'art', icon: 'üé®', name: 'Ëâ∫ÊúØ', color: '#c026d3', keywords: ['abstract','aesthetic','canvas','chiaroscuro','composition','fresco','gallery','impressionism','mosaic','palette','perspective','portrait','renaissance','sculpture','surrealism'] },
];

const COURSE_DATA = {
  level1: { title: 'Level 1ÔºöÊ†∏ÂøÉÂâçÁºÄ', description: 'ÊéåÊè°ÊúÄÂ∏∏Áî®ÁöÑÂâçÁºÄÔºå‰∏ÄÁúºÁúãÁ©øÂçïËØçÊñπÂêë', units: [
    { id:'u1', title:'Êï∞Â≠óÂâçÁºÄ', subtitle:'uni-, bi-, tri-, quad-, cent-...', rootCount:10, wordCount:90, roots:['uni- (‰∏Ä)','bi- (‰∫å)','tri- (‰∏â)','quad- (Âõõ)','pent- (‰∫î)','hex- (ÂÖ≠)','sept- (‰∏É)','oct- (ÂÖ´)','dec- (ÂçÅ)','cent- (Áôæ)'], words:['universe','unique','uniform','bicycle','bilingual','binary','triangle','tripod','trilogy','quadrant','quarter','pentagon','hexagon','September','October','decade','decimal','century','percent','centimeter'] },
    { id:'u2', title:'ÊñπÂêëÂâçÁºÄÔºà‰∏äÔºâ', subtitle:'ex-, in-, pro-, re-...', rootCount:8, wordCount:100, roots:['ex- (Âá∫/Â§ñ)','in-/im- (ËøõÂÖ•/ÂÜÖ)','pro- (ÂêëÂâç)','re- (ËøîÂõû/ÂÜç)','pre- (‰πãÂâç)','post- (‰πãÂêé)','ante- (Ââç)','retro- (ÂêëÂêé)'], words:['export','exclude','external','exhale','import','include','internal','inhale','progress','promote','project','return','review','rebuild','predict','prevent','prefix','postpone','postwar','retrospect'] },
    { id:'u3', title:'ÊñπÂêëÂâçÁºÄÔºà‰∏ãÔºâ', subtitle:'trans-, sub-, super-, inter-...', rootCount:8, wordCount:100, roots:['trans- (Á©øË∂ä)','sub- (‰∏ã/Ê¨°)','super-/sur- (‰∏ä/Ë∂Ö)','inter- (‰πãÈó¥)','intra- (ÂÜÖÈÉ®)','circum- (ÁéØÁªï)','extra- (È¢ùÂ§ñ)','ultra- (Ë∂ÖË∂ä)'], words:['transport','translate','transfer','submarine','subway','subtract','superior','surface','survive','international','internet','interact','intramural','circumference','circumstance','extraordinary','extravagant','ultraviolet','ultimate','ultramodern'] },
    { id:'u4', title:'Âê¶ÂÆöÂâçÁºÄ', subtitle:'un-, in-, dis-, non-, anti-...', rootCount:10, wordCount:120, roots:['un- (‰∏ç)','in-/im-/il-/ir- (‰∏ç)','dis- (‰∏ç/Áõ∏Âèç)','non- (Èùû)','anti- (ÂèçÂØπ)','counter- (ÂØπÊäó)','mis- (ÈîôËØØ)','mal- (Âùè)','de- (ÂéªÈô§/Âêë‰∏ã)','ab- (Á¶ªÂºÄ)'], words:['unknown','unusual','unable','impossible','illegal','irregular','disagree','discover','disappear','nonsense','nonprofit','antibiotic','antithesis','counterpart','misunderstand','malfunction','malicious','decrease','depart','abnormal','absent'] },
    { id:'u5', title:'Â§ßÂ∞è‰∏éÈáè', subtitle:'micro-, macro-, mega-, mini-...', rootCount:8, wordCount:80, roots:['micro- (Â∞è)','macro- (Â§ß)','mega- (Â∑®Â§ß)','mini- (Â∞è)','multi- (Â§ö)','poly- (Â§ö)','mono- (Âçï‰∏Ä)','omni- (ÂÖ®ÈÉ®)'], words:['microscope','microphone','macroeconomics','megabyte','megaphone','miniature','minimum','multiply','multitude','polygon','polyglot','monopoly','monotone','omnipotent','omnivore','omniscient'] },
    { id:'u6', title:'Êó∂Èó¥‰∏éÈ°∫Â∫è', subtitle:'pre-, post-, neo-, proto-...', rootCount:8, wordCount:70, roots:['pre- (Ââç/ÂÖà)','post- (Âêé)','neo- (Êñ∞)','proto- (ÊúÄÂàù)','prim- (Á¨¨‰∏Ä)','chron- (Êó∂Èó¥)','temp- (Êó∂Èó¥)','ann-/enn- (Âπ¥)'], words:['preview','prehistoric','prelude','postpone','postscript','neologism','neonatal','prototype','protocol','primary','primitive','chronicle','chronological','temporary','contemporary','annual','anniversary','perennial'] },
  ]},
  level2: { title: 'Level 2ÔºöÊãâ‰∏ÅÊ†∏ÂøÉËØçÊ†π', description: 'ÊúÄÂÆûÁî®ÁöÑÊãâ‰∏ÅËØ≠ËØçÊ†πÔºåË¶ÜÁõñÊó•Â∏∏80%ËØçÊ±á', units: [
    { id:'u7', title:'Áúã‰∏éËØ¥', subtitle:'spec-, vid-, dict-, voc-...', rootCount:8, wordCount:100, roots:['spec-/spect- (Áúã)','vid-/vis- (Áúã)','dict- (ËØ¥)','voc-/vok- (Â£∞Èü≥/Âè´)','log-/loqu- (ËØ¥)','clar- (Ê∏ÖÊ•ö)','audi- (Âê¨)','son- (Â£∞Èü≥)'], words:['inspect','spectacle','perspective','suspect','visible','video','evidence','vision','dictate','predict','dictionary','vocal','invoke','provoke','eloquent','dialogue','clarify','declare','audience','auditorium','resonance','consonant'] },
    { id:'u8', title:'Êâã‰∏éÂÅö', subtitle:'man-, fac-, oper-, stru-...', rootCount:8, wordCount:100, roots:['man-/manu- (Êâã)','fac-/fic-/fect- (ÂÅö/ÈÄ†)','oper- (Â∑•‰Ωú)','stru-/struct- (Âª∫ÈÄ†)','pon-/pos- (ÊîæÁΩÆ)','tract- (Êãâ)','press- (Âéã)','ject- (ÊäïÊé∑)'], words:['manual','manipulate','manufacture','factory','efficient','defect','perfect','operate','cooperate','construct','structure','destroy','compose','deposit','expose','attract','contract','extract','compress','express','inject','project','reject'] },
    { id:'u9', title:'Ëµ∞‰∏éÈÄÅ', subtitle:'ced-, duct-, port-, mit-...', rootCount:8, wordCount:100, roots:['ced-/cess- (Ëµ∞/ËÆ©)','duct-/duc- (ÂºïÂØº)','port- (Êê∫Â∏¶)','mit-/miss- (ÈÄÅ/Êîæ)','ven-/vent- (Êù•)','cur-/curs- (Ë∑ë)','grad-/gress- (Ê≠•)','mob-/mot- (Âä®)'], words:['proceed','access','succeed','exceed','conduct','educate','introduce','portable','transport','import','transmit','admit','permit','adventure','event','prevent','current','occur','excursion','graduate','progress','aggressive','mobile','emotion','promote'] },
    { id:'u10', title:'ÂøÉ‰∏éÊÑü', subtitle:'cord-, sens-, pass-, anim-...', rootCount:8, wordCount:80, roots:['cord-/cour- (ÂøÉ)','sens-/sent- (ÊÑüËßâ)','pass-/path- (ÊÑüÂèó/ÂèóËã¶)','anim- (ÁÅµÈ≠Ç/ÁîüÂëΩ)','grat- (ÊÑüË∞¢/ÊÑâÂø´)','viv-/vit- (Ê¥ª)','mort- (Ê≠ª)','nasc-/nat- (Âá∫Áîü)'], words:['courage','encourage','accord','sensitive','sentiment','consent','passion','compassion','sympathy','animate','animal','unanimous','grateful','gratitude','congratulate','vivid','survive','vital','mortal','immortal','mortgage','native','natural','nation','innate'] },
    { id:'u11', title:'Áü•‰∏é‰ø°', subtitle:'sci-, cogn-, cred-, cert-...', rootCount:8, wordCount:80, roots:['sci- (Áü•ÈÅì)','cogn-/gnos- (ËÆ§ËØÜ)','cred- (Áõ∏‰ø°)','cert- (Á°ÆÂÆö)','ver- (ÁúüÂÆû)','doc- (Êïô)','memor- (ËÆ∞ÂøÜ)','prov-/prob- (ËØÅÊòé)'], words:['science','conscious','omniscient','recognize','cognition','diagnosis','credit','incredible','credential','certain','certificate','verify','verdict','veritable','doctor','document','doctrine','memory','memorize','commemorate','prove','approve','probable'] },
    { id:'u12', title:'Âäõ‰∏éÊ≤ª', subtitle:'fort-, pot-, reg-, dom-...', rootCount:8, wordCount:80, roots:['fort-/forc- (Âº∫)','pot-/poss- (ËÉΩÂäõ)','reg-/rect- (ÁªüÊ≤ª/Ê≠£)','dom- (ÁªüÊ≤ª/ÂÆ∂)','liber- (Ëá™Áî±)','serv- (ÊúçÂä°/‰øùÊåÅ)','jud-/jur- (Âà§Êñ≠/Ê≥ïÂæã)','leg- (Ê≥ïÂæã/ËØª)'], words:['effort','enforce','comfort','potential','possible','power','regulate','correct','direct','rectangle','dominate','domestic','domain','liberty','liberal','liberate','serve','observe','preserve','judge','jury','justice','legal','legislate','legitimate'] },
  ]},
  level3: { title: 'Level 3ÔºöÂ∏åËÖäÁßëÂ≠¶ËØçÊ†π', description: 'ÊâìÈÄöÁßëÂ≠¶„ÄÅÂåªÂ≠¶„ÄÅÊäÄÊúØÈ¢ÜÂüüÁöÑËØçÊ±áÂ£ÅÂûí', units: [
    { id:'u13', title:'ÁîüÂëΩ‰∏éËá™ÁÑ∂', subtitle:'bio-, zoo-, botan-, eco-...', rootCount:8, wordCount:80, roots:['bio- (ÁîüÂëΩ)','zoo- (Âä®Áâ©)','botan- (Ê§çÁâ©)','eco- (ÂÆ∂/ÁéØÂ¢É)','gen- (‰∫ßÁîü/ÁßçÁ±ª)','morph- (ÂΩ¢Áä∂)','phys- (Ëá™ÁÑ∂)','organ- (Âô®ÂÆò/ÁªÑÁªá)'], words:['biology','biography','antibiotic','zoology','zoo','protozoa','botany','botanical','ecology','ecosystem','economy','generate','genetics','genocide','metamorphosis','amorphous','physics','physiology','physician','organism','organic','organize'] },
    { id:'u14', title:'Âú∞ÁêÉ‰∏éÂÆáÂÆô', subtitle:'geo-, astro-, cosm-, seism-...', rootCount:8, wordCount:80, roots:['geo- (Âú∞ÁêÉ)','astro-/aster- (Êòü)','cosm- (ÂÆáÂÆô)','seism- (Èúá)','hydr- (Ê∞¥)','pyro- (ÁÅ´)','aer- (Á©∫Ê∞î)','lith- (Áü≥Â§¥)'], words:['geography','geology','geometry','astronaut','astronomy','asteroid','disaster','cosmos','cosmopolitan','cosmic','seismology','earthquake','hydrogen','hydraulic','dehydrate','pyromaniac','pyrotechnic','aerobics','aerospace','aerodynamic','lithograph','monolith','Neolithic'] },
    { id:'u15', title:'ÊµãÈáè‰∏é‰π¶ÂÜô', subtitle:'meter-, graph-, log-, scope-...', rootCount:8, wordCount:80, roots:['-meter/metr- (ÊµãÈáè)','-graph/-graphy (ÂÜô/ËÆ∞ÂΩï)','-logy/-log- (Â≠¶ÈóÆ/ËØ¥)','-scope (Áúã)','techn- (ÊäÄÊúØ)','typ- (Á±ªÂûã/Âç∞)','nom-/nym- (ÂêçÂ≠ó/Ê≥ïÂàô)','stat- (Á´ôÁ´ã/Áä∂ÊÄÅ)'], words:['thermometer','diameter','geometry','paragraph','photograph','biography','telegraph','biology','psychology','technology','etymology','microscope','telescope','stethoscope','technique','technology','typical','prototype','synonym','anonymous','economy','astronomy','statistics','thermostat'] },
    { id:'u16', title:'ÊÄùÁª¥‰∏éÂøÉÁÅµ', subtitle:'psych-, phil-, soph-, log-...', rootCount:8, wordCount:80, roots:['psych- (ÂøÉÁÅµ)','phil- (Áà±)','soph- (Êô∫ÊÖß)','mania- (ÁñØÁãÇ)','phob- (ÊÅêÊÉß)','path- (ÊÑüÂèó/ÁñæÁóÖ)','crit- (Âà§Êñ≠)','the- (Á•û)'], words:['psychology','psychiatry','psychotherapy','philosophy','philanthropy','bibliophile','sophisticated','sophomore','mania','kleptomania','megalomania','phobia','claustrophobia','arachnophobia','empathy','apathy','sympathy','pathology','criticism','criterion','hypocrite','theology','theocracy','atheist'] },
    { id:'u17', title:'ÊùÉÂäõ‰∏éÁ§æ‰ºö', subtitle:'demo-, crat-, arch-, polis-...', rootCount:8, wordCount:80, roots:['demo- (‰∫∫Ê∞ë)','crat-/cracy (ÁªüÊ≤ª)','arch-/archy (ÁªüÊ≤ª/È¶ñË¶Å)','polis-/polit- (ÂüéÂ∏Ç/ÂõΩÂÆ∂)','anthrop- (‰∫∫Á±ª)','ethn- (Ê∞ëÊóè)','soci- (Âêå‰º¥)','civ- (ÂÖ¨Ê∞ë)'], words:['democracy','demographic','epidemic','bureaucracy','aristocracy','plutocracy','monarchy','anarchy','archbishop','archetype','metropolis','politics','cosmopolitan','police','anthropology','misanthrope','philanthropy','ethnic','ethnicity','ethnocentric','society','social','associate','civil','civilization','citizen'] },
    { id:'u18', title:'Ë∫´‰Ωì‰∏éÂÅ•Â∫∑', subtitle:'cardio-, neuro-, derm-, hem-...', rootCount:10, wordCount:100, roots:['cardio- (ÂøÉ)','neuro- (Á•ûÁªè)','derm- (ÁöÆËÇ§)','hemo-/hem- (Ë°Ä)','osteo- (È™®)','gastro- (ËÉÉ)','pneum- (ËÇ∫/Ê∞î)','ophthalm- (Áúº)','ped-/pod- (Ë∂≥)','cephal- (Â§¥)'], words:['cardiology','cardiovascular','cardiac','neuroscience','neurology','neural','dermatology','dermatitis','epidermis','hemorrhage','hemoglobin','anemia','osteoporosis','osteopath','gastritis','gastronomy','pneumonia','pneumatic','ophthalmology','optician','pediatric','podiatrist','tripod','encephalitis','cephalopod'] },
  ]},
  level4: { title: 'Level 4ÔºöÈ´òÁ∫ßËØçÊ†πÁªÑÂêà', description: 'ÊéåÊè°Â§çÊùÇËØçÊ±áÁöÑÊûÑËØçÈÄªËæëÔºåÈòÖËØªÂ≠¶ÊúØÊñáÁåÆÊó†ÈöúÁ¢ç', units: [
    { id:'u19', title:'ÂèòÂåñ‰∏éËΩ¨Êç¢', subtitle:'vert-, muta-, alter-, volv-...', rootCount:8, wordCount:80, roots:['vert-/vers- (ËΩ¨)','muta- (ÂèòÂåñ)','alter- (ÂÖ∂‰ªñ/Âèò)','volv-/volut- (Âç∑/ËΩ¨)','flux-/flu- (ÊµÅ)','form- (ÂΩ¢Áä∂)','vari- (ÂèòÂåñ)','norm- (ËßÑËåÉ)'], words:['convert','reverse','versatile','diverse','controversy','universe','mutation','mutate','immutable','commute','alternate','alternative','alter','evolve','revolution','involve','dissolve','fluctuate','influence','fluent','reform','transform','uniform','information','variable','variety','various','normal','enormous','abnormal'] },
    { id:'u20', title:'ËÅîÂêà‰∏éÂàÜÁ¶ª', subtitle:'syn-, dis-, se-, co-...', rootCount:8, wordCount:80, roots:['syn-/sym- (‰∏ÄËµ∑)','co-/com-/con- (ÂÖ±Âêå)','dis- (ÂàÜÂºÄ)','se- (ÂàÜÁ¶ª)','frag-/fract- (Á¢é)','rupt- (Á†¥)','sect-/seg- (Âàá)','fin- (ÁªìÊùü/ÁïåÈôê)'], words:['synthesis','symphony','symptom','synchronize','cooperate','community','combine','connect','disconnect','distribute','disperse','dispute','separate','seclude','secret','secede','fragment','fraction','fracture','interrupt','bankrupt','corrupt','erupt','section','segment','insect','bisect','final','infinite','define','confine'] },
    { id:'u21', title:'ÊäΩË±°Ê¶ÇÂøµ', subtitle:'caus-, quest-, pend-, val-...', rootCount:8, wordCount:80, roots:['caus-/cus- (ÂéüÂõ†/ÊéßËØâ)','quer-/quest-/quir- (ÂØªÊ±Ç)','pend-/pens- (ÊÇ¨ÊåÇ/Áß∞Èáç)','val-/vail- (‰ª∑ÂÄº/Âº∫)','equ- (Áõ∏Á≠â)','simil-/simul- (Áõ∏‰ºº)','magn- (Â§ß)','brev- (Áü≠)'], words:['cause','accuse','excuse','because','question','request','require','acquire','inquire','depend','suspend','pension','expensive','compensate','value','valid','available','evaluate','prevail','equal','equivalent','equation','similar','simulate','simultaneous','magnify','magnificent','magnitude','abbreviate','brevity','brief'] },
    { id:'u22', title:'Êó∂Èó¥‰∏éÁ©∫Èó¥', subtitle:'chron-, loc-, terr-, via-...', rootCount:8, wordCount:80, roots:['chron- (Êó∂Èó¥)','loc- (Âú∞Êñπ)','terr- (Âú∞/Âúü)','via-/voy- (Ë∑Ø)','spati- (Á©∫Èó¥)','centr- (‰∏≠ÂøÉ)','later- (‰æßÈù¢)','margin- (ËæπÁºò)'], words:['chronic','chronicle','chronological','synchronize','anachronism','locate','local','allocate','dislocate','territory','terrain','terrestrial','subterranean','Mediterranean','deviate','voyage','trivial','obvious','spatial','spacious','concentrate','eccentric','egocentric','lateral','bilateral','collateral','marginal','margin','marginalize'] },
    { id:'u23', title:'Èáè‰∏éÂ∫¶', subtitle:'grav-, lev-, plen-, vac-...', rootCount:8, wordCount:80, roots:['grav-/griev- (Èáç)','lev- (ËΩª/‰∏æ)','plen-/plet- (Êª°)','vac-/van- (Á©∫)','ample-/ampl- (Â§ß/Â§ö)','satis- (Ë∂≥Â§ü)','super-/suprem- (ÊúÄÈ´ò)','minim- (ÊúÄÂ∞è)'], words:['gravity','grave','aggravate','grieve','grievance','elevate','lever','alleviate','relieve','relevant','plenty','complete','supplement','implement','deplete','vacuum','vacant','evacuate','vanish','vain','ample','amplify','example','satisfy','saturate','satiate','supreme','superiority','superb','minimize','diminish'] },
    { id:'u24', title:'Ë°å‰∏∫‰∏éÁä∂ÊÄÅ', subtitle:'habit-, sist-, tain-, plic-...', rootCount:8, wordCount:80, roots:['habit-/hibit- (Êã•Êúâ/Â±Ö‰Ωè)','sist-/stat- (Á´ôÁ´ã)','tain-/ten- (ÊåÅÊúâ)','plic-/plex-/ply- (ÊäòÂè†)','clin- (ÂÄæÊñú)','pend- (ÊÇ¨ÊåÇ)','sed-/sid-/sess- (Âùê)','ven-/vent- (Êù•)'], words:['habit','inhabit','exhibit','prohibit','consist','resist','persist','assist','insist','exist','contain','obtain','maintain','retain','sustain','detain','entertain','complicate','complex','apply','reply','imply','multiply','explicit','implicit','decline','incline','recline','depend','independent','suspend','reside','session','president','sediment','adventure','event','convention','invent','prevent'] },
  ]},
  level5: { title: 'Level 5ÔºöÂ≠¶ÊúØÈòÖËØªËØçÊ†π', description: 'ÂæÅÊúçÂ≠¶ÊúØËÆ∫ÊñáÂíåËã±ÊñáÂéüËëóÁöÑÊúÄÂêé‰∏ÄÂÖ≥', units: [
    { id:'u25', title:'ËÆ∫ËØÅ‰∏éÊé®ÁêÜ', subtitle:'thesis-, hypo-, para-, anti-...', rootCount:8, wordCount:80, roots:['thes-/thet- (ÊîæÁΩÆ/ËÆ∫È¢ò)','hypo- (Âú®‰∏ã/ÂÅáËÆæ)','para- (ÊóÅËæπ/Á±ª‰ºº)','ana- (Âêë‰∏ä/ÂàÜÊûê)','dia- (Á©øËøá/ÂØπÈù¢)','meta- (Ë∂ÖË∂ä/ÂèòÂåñ)','epi- (Âú®‰∏ä/‰πãÂêé)','peri- (Âë®Âõ¥)'], words:['thesis','hypothesis','antithesis','synthesis','parenthesis','hypothetical','hypotenuse','parallel','paradox','parasite','paragraph','analysis','anatomy','analogy','dialogue','diagnosis','diameter','metaphor','metabolism','metamorphosis','epidemic','epilogue','episode','epitome','perimeter','peripheral','period','peril'] },
    { id:'u26', title:'Á®ãÂ∫¶‰∏éÊØîËæÉ', subtitle:'super-, hyper-, infra-, pseudo-...', rootCount:8, wordCount:70, roots:['super-/supra- (Ë∂Ö/‰∏ä)','hyper- (ËøáÂ∫¶)','infra- (‰∏ã/Âü∫Á°Ä)','pseudo- (ÂÅá)','neo- (Êñ∞)','paleo- (Âè§)','eu- (Â•Ω/Áúü)','dys- (Âùè/Âõ∞Èöæ)'], words:['supernatural','superlative','supreme','hyperactive','hyperbole','hypersensitive','infrastructure','infrared','pseudonym','pseudoscience','neoclassical','neonatal','neologism','paleontology','Paleolithic','euphoria','eulogy','euphemism','euthanasia','dystopia','dyslexia','dysfunctional'] },
    { id:'u27', title:'ËØ≠Ë®Ä‰∏éÊñáÂ≠ó', subtitle:'scrib-, liter-, lex-, lingua-...', rootCount:8, wordCount:80, roots:['scrib-/script- (ÂÜô)','liter- (ÊñáÂ≠ó)','lex-/lect- (ËØª/ÈÄâ)','lingua-/lingu- (ËØ≠Ë®Ä)','gram-/graph- (ÂÜô/Áîª)','dict- (ËØ¥)','narr- (ËÆ≤Ëø∞)','nomin-/noun- (ÂêçÂ≠ó)'], words:['describe','scripture','manuscript','inscription','prescribe','subscribe','literature','literal','literate','illiterate','select','collect','elect','lecture','intellect','language','linguistics','bilingual','grammar','diagram','biography','calligraphy','contradict','indicate','dedicate','dictator','narrative','narrator','nominate','pronounce','announce','denounce','renounce'] },
    { id:'u28', title:'Á§æ‰ºö‰∏é‰º¶ÁêÜ', subtitle:'moral-, ethic-, just-, hum-...', rootCount:8, wordCount:70, roots:['moral-/mor- (‰π†‰øó/ÈÅìÂæ∑)','ethic- (‰º¶ÁêÜ)','just-/jur- (ÂÖ¨Ê≠£/Ê≥ï)','hum- (‰∫∫/Âú∞)','benev- (Â•Ω)','malev- (Âùè)','sacr-/sanct- (Á•ûÂú£)','virt- (ÁæéÂæ∑/ÂäõÈáè)'], words:['moral','morale','demoralize','ethics','ethical','justice','justify','injustice','perjury','humane','humanitarian','humble','humility','benevolent','benefit','benediction','malevolent','malice','malignant','sacred','sacrifice','sanctuary','sanctify','virtue','virtual','virtuoso'] },
    { id:'u29', title:'Ëá™ÁÑ∂‰∏éÁâ©Ë¥®', subtitle:'nat-, terra-, aqua-, aur-...', rootCount:8, wordCount:70, roots:['nat-/nasc- (Âá∫Áîü/Ëá™ÁÑ∂)','terra-/terr- (Âú∞)','aqua- (Ê∞¥)','lum-/luc- (ÂÖâ)','ign- (ÁÅ´)','vent- (È£é)','sol- (Â§™Èò≥)','lun- (Êúà‰∫Æ)'], words:['nature','native','nation','innate','renaissance','territory','terrain','terrestrial','extraterrestrial','Mediterranean','aquarium','aquatic','aqueduct','illuminate','lucid','translucent','elucidate','ignite','ignition','igneous','ventilate','adventure','solar','solstice','parasol','lunar','lunatic','sublunary'] },
    { id:'u30', title:'ÁªºÂêàÊåëÊàò', subtitle:'Êú¨ËØæÁ®ãÊ†∏ÂøÉËØçÊ†πÂÖ®ÂõûÈ°æ', rootCount:12, wordCount:150, roots:['phon-/phone- (Â£∞Èü≥)','aesth- (ÊÑüËßâ)','crypt- (ÈöêËóè)','auto- (Ëá™Êàë)','homo- (Áõ∏Âêå)','hetero- (‰∏çÂêå)','pan- (ÂÖ®ÈÉ®)','tox- (ÊØí)','gam- (Â©öÂßª)','cosm- (ÂÆáÂÆô/Áß©Â∫è)','soph- (Êô∫ÊÖß)','anthrop- (‰∫∫)'], words:['telephone','microphone','symphony','phonetic','aesthetic','anesthesia','encrypt','cryptic','apocryphal','autobiography','autonomy','autograph','homogeneous','homosexual','homonym','heterogeneous','heterodox','pandemic','panacea','panorama','toxic','intoxicate','detoxify','monogamy','bigamy','cosmopolitan','microcosm','philosophy','sophisticated','anthropology','misanthrope','philanthropy'] },
  ]}
};

const DAILY_ARTICLES = [
  { day:1, theme:'Êï∞Â≠óËØçÊ†π', title:'‰ªéuni-Âà∞milli-: Êï∞Â≠óÂ¶Ç‰ΩïÂ°ëÈÄ†ËØ≠Ë®Ä', content:'‰Ω†Áü•ÈÅìÂêóÔºüuniversityÔºàÂ§ßÂ≠¶ÔºâÂíåuniverseÔºàÂÆáÂÆôÔºâÊúâÁùÄÁõ∏ÂêåÁöÑËØçÊ†πÔºÅuni-Êù•Ëá™Êãâ‰∏ÅËØ≠unusÔºåÊÑè‰∏∫"‰∏Ä"„ÄÇÂ§ßÂ≠¶ÊúÄÂàùÁöÑÂê´‰πâÊòØ"Â∏àÁîüÁªü‰∏Ä‰Ωì"‚Äî‚ÄîÊâÄÊúâ‰∫∫united‰∏∫‰∏Ä‰∏™Êï¥‰Ωì„ÄÇËÄåÂÆáÂÆôÂàôÊòØ"‰∏ÄÂàáËΩ¨ÂêëÂêå‰∏Ä‰∏™ÊñπÂêë"ÁöÑÊÑèÊÄù„ÄÇ\n\nÂêåÊ†∑ÔºåbicycleÁöÑbi-Ë°®Á§∫"‰∫å"Ôºà‰∏§‰∏™ËΩÆÂ≠êÔºâÔºåtriangleÁöÑtri-Ë°®Á§∫"‰∏â"Ôºà‰∏â‰∏™ËßíÔºâÔºåËÄåcenturyÊù•Ëá™cent-Ë°®Á§∫"‰∏ÄÁôæ"Ôºà‰∏ÄÁôæÂπ¥Ôºâ„ÄÇÊéåÊè°Ëøô‰∫õÊï∞Â≠óËØçÊ†πÔºå‰Ω†Â∞±ËÉΩËΩªÊùæÁêÜËß£Âá†Áôæ‰∏™ÂçïËØçÔºÅ', roots:['uni-','bi-','tri-','cent-'], examples:[{word:'universe',meaning:'ÂÆáÂÆôÔºà‰∏Ä‰∏™Êï¥‰ΩìÔºâ'},{word:'bicycle',meaning:'Ëá™Ë°åËΩ¶Ôºà‰∏§‰∏™ËΩÆÂ≠êÔºâ'}] },
  { day:2, theme:'ÊñπÂêëËØçÊ†π', title:'Ëøõ‰∏éÂá∫Ôºöex-Âíåin-ÁöÑÂ•áÂ¶ô‰∏ñÁïå', content:'exportÂíåimportÊòØ‰∏ÄÂØπÊúâË∂£ÁöÑÂèç‰πâËØç„ÄÇex-Ë°®Á§∫"Âá∫"ÔºåportË°®Á§∫"Êê∫Â∏¶"ÔºåÊâÄ‰ª•exportÂ∞±ÊòØ"Êê∫Â∏¶Âá∫Âéª"=Âá∫Âè£„ÄÇËÄåin-Ë°®Á§∫"ËøõÂÖ•"ÔºåimportÂ∞±ÊòØ"Êê∫Â∏¶ËøõÊù•"=ËøõÂè£„ÄÇ\n\nËøô‰∏™ËßÑÂæãÈÄÇÁî®‰∫éÂæàÂ§öËØçÔºöexcludeÔºàÊéíÈô§Âú®Â§ñÔºâvs includeÔºàÂåÖÂê´Âú®ÂÜÖÔºâÔºåexternalÔºàÂ§ñÈÉ®ÁöÑÔºâvs internalÔºàÂÜÖÈÉ®ÁöÑÔºâ„ÄÇËÆ∞‰ΩèËøô‰∫õÂâçÁºÄÁöÑÊñπÂêëÊÑüÔºåËØçÊ±áÂ≠¶‰π†‰∫ãÂçäÂäüÂÄçÔºÅ', roots:['ex-','in-','port-'], examples:[{word:'export',meaning:'Âá∫Âè£ÔºàÂ∏¶Âá∫ÂéªÔºâ'},{word:'import',meaning:'ËøõÂè£ÔºàÂ∏¶ËøõÊù•Ôºâ'}] },
  { day:3, theme:'ÁßëÂ≠¶ËØçÊ†π', title:'Â∏åËÖä‰∫∫ÁöÑÊô∫ÊÖßÔºöbio-, geo-, photo-', content:'biology‰∏∫‰ªÄ‰πàÂè´ÁîüÁâ©Â≠¶ÔºüÂõ†‰∏∫bio-Êù•Ëá™Â∏åËÖäËØ≠biosÔºåÊÑè‰∏∫"ÁîüÂëΩ"ÔºåËÄå-logyË°®Á§∫"Â≠¶ÈóÆ"„ÄÇÊâÄ‰ª•biologyÂ∞±ÊòØ"ÂÖ≥‰∫éÁîüÂëΩÁöÑÂ≠¶ÈóÆ"„ÄÇ\n\nÂêåÁêÜÔºågeographyÔºàÂú∞ÁêÜÂ≠¶Ôºâ= geo-ÔºàÂú∞ÁêÉÔºâ+ -graphyÔºà‰π¶ÂÜô/ÊèèËø∞ÔºâÔºåphotographÔºàÁÖßÁâáÔºâ= photo-ÔºàÂÖâÔºâ+ -graphÔºàÂÜôÔºâÔºåÊòØ"Áî®ÂÖâÊù•‰π¶ÂÜô"ÔºåÂõ†‰∏∫Êó©ÊúüÊëÑÂΩ±Á°ÆÂÆûÊòØÁî®ÂÖâÂú®ËÉ∂Áâá‰∏ä"ÂÜô"‰∏ãÂõæÂÉèÔºÅ', roots:['bio-','geo-','photo-','-logy'], examples:[{word:'biology',meaning:'ÁîüÁâ©Â≠¶'},{word:'photograph',meaning:'ÁÖßÁâáÔºàÂÖâÂÜôÔºâ'}] },
  { day:4, theme:'Ë∫´‰ΩìËØçÊ†π', title:'‰ªéÂøÉÂà∞ËÑëÔºöÂåªÂ≠¶ËØçÊ†πÁöÑÊïÖ‰∫ã', content:'cardiologyÔºàÂøÉËÑèÁóÖÂ≠¶ÔºâÁöÑcardio-Êù•Ëá™Â∏åËÖäËØ≠kardiaÔºåÊÑè‰∏∫"ÂøÉËÑè"„ÄÇÊúâË∂£ÁöÑÊòØÔºåËã±ËØ≠‰∏≠ÁöÑheartÂíåÂ∏åËÖäËØ≠kardiaÂÖ∂ÂÆûÊúâÂÖ±ÂêåÁöÑÂç∞Ê¨ßËØ≠Á•ñÂÖàÔºÅ\n\nneurologyÔºàÁ•ûÁªèÁóÖÂ≠¶ÔºâÁöÑneuro-Êù•Ëá™Â∏åËÖäËØ≠neuronÔºåÂéüÊÑèÊòØ"Âº¶„ÄÅËÖ±"ÔºåÂêéÊù•ÂºïÁî≥‰∏∫"Á•ûÁªè"‚Äî‚ÄîÂõ†‰∏∫Á•ûÁªèÁúãËµ∑Êù•ÂÉèË∫´‰ΩìÈáåÁöÑÁªÜÂº¶„ÄÇdermatologyÔºàÁöÆËÇ§ÁßëÔºâÁöÑderm-ÂàôÊù•Ëá™Â∏åËÖäËØ≠dermaÔºåÊÑè‰∏∫"ÁöÆËÇ§"„ÄÇ', roots:['cardio-','neuro-','derm-'], examples:[{word:'cardiology',meaning:'ÂøÉËÑèÁóÖÂ≠¶'},{word:'neurology',meaning:'Á•ûÁªèÁóÖÂ≠¶'}] },
  { day:5, theme:'Âä®‰ΩúËØçÊ†π', title:'duct, port, scribÔºö‰∏â‰∏™‰∏áËÉΩÂä®ËØçÊ†π', content:'duct-Êù•Ëá™Êãâ‰∏ÅËØ≠ducereÔºåÊÑè‰∏∫"ÂºïÂØº„ÄÅÂ∏¶È¢Ü"„ÄÇÊâÄ‰ª•conductorÊòØ"‰∏ÄËµ∑ÂºïÂØºÁöÑ‰∫∫"ÔºàÊåáÊå•/ÂîÆÁ•®ÂëòÔºâÔºåintroductionÊòØ"ÂºïÂØºËøõÂÖ•"Ôºà‰ªãÁªç/ÂºïË®ÄÔºâ„ÄÇ\n\nport-Êù•Ëá™Êãâ‰∏ÅËØ≠portareÔºåÊÑè‰∏∫"Êê∫Â∏¶"„ÄÇportableÊòØ"ÂèØÊê∫Â∏¶ÁöÑ"ÔºåtransportÊòØ"Ë∑®Ë∂äÊê∫Â∏¶"=ËøêËæì„ÄÇ\n\nscrib-/script-Êù•Ëá™Êãâ‰∏ÅËØ≠scribereÔºåÊÑè‰∏∫"ÂÜô"„ÄÇdescribeÊòØ"Âêë‰∏ãÂÜô"=ÊèèËø∞ÔºåmanuscriptÊòØ"ÊâãÂÜôÁöÑ"=ÊâãÁ®ø„ÄÇ', roots:['duct-','port-','scrib-'], examples:[{word:'conduct',meaning:'ÂºïÂØº„ÄÅÊåáÊå•'},{word:'describe',meaning:'ÊèèËø∞ÔºàÂêë‰∏ãÂÜôÔºâ'}] },
  { day:6, theme:'ÊÄùÁª¥ËØçÊ†π', title:'phil-Âíåsoph-ÔºöÁà±‰∏éÊô∫ÊÖß', content:'philosophyÊòØ‰ªÄ‰πàÊÑèÊÄùÔºüphil-Êù•Ëá™Â∏åËÖäËØ≠philosÔºåÊÑè‰∏∫"Áà±"Ôºåsoph-Êù•Ëá™sophiaÔºåÊÑè‰∏∫"Êô∫ÊÖß"„ÄÇÊâÄ‰ª•philosophyÂ∞±ÊòØ"Áà±Êô∫ÊÖß"‚Äî‚ÄîÂØπÊô∫ÊÖßÁöÑÁÉ≠Áà±‰∏éËøΩÊ±Ç„ÄÇ\n\nphilanthropyÔºàÊÖàÂñÑÔºâ= phil-ÔºàÁà±Ôºâ+ anthrop-Ôºà‰∫∫Á±ªÔºâÔºåÁà±‰∫∫Á±ª„ÄÇ\nsophisticatedÔºàÂ§çÊùÇÁ≤æÂØÜÁöÑÔºâÂéüÊú¨Êåá"ÂÉèÊô∫ËÄÖ‰∏ÄÊ†∑"ÔºåÂêéÊù•ÂºïÁî≥‰∏∫"ËÄÅÁªÉÁöÑ„ÄÅÁ≤æÂØÜÁöÑ"„ÄÇ', roots:['phil-','soph-','anthrop-'], examples:[{word:'philosophy',meaning:'Âì≤Â≠¶ÔºàÁà±Êô∫ÊÖßÔºâ'},{word:'philanthropy',meaning:'ÊÖàÂñÑÔºàÁà±‰∫∫Á±ªÔºâ'}] },
  { day:7, theme:'ÁîüÊ≠ªËØçÊ†π', title:'viv-Âíåmort-ÔºöÁîü‰∏éÊ≠ªÁöÑËØ≠Ë®ÄÂØÜÁ†Å', content:'survive‰∏∫‰ªÄ‰πàË°®Á§∫"Âπ∏Â≠ò"Ôºüsur-Ë°®Á§∫"Ë∂ÖË∂ä"Ôºåviv-Êù•Ëá™Êãâ‰∏ÅËØ≠vivereÔºåÊÑè‰∏∫"Ê¥ª"„ÄÇÊâÄ‰ª•surviveÂ∞±ÊòØ"Ë∂ÖË∂ä‰∫ÜÊ≠ª‰∫°ÁªßÁª≠Ê¥ªÁùÄ"=Âπ∏Â≠ò„ÄÇvividÔºàÁîüÂä®ÁöÑÔºâ‰πüÊù•Ëá™Âêå‰∏ÄËØçÊ†π‚Äî‚ÄîÂÖÖÊª°ÁîüÂëΩÂäõÁöÑ„ÄÇ\n\nÁõ∏ÂèçÔºåmort-Êù•Ëá™Êãâ‰∏ÅËØ≠mors/mortisÔºåÊÑè‰∏∫"Ê≠ª‰∫°"„ÄÇmortalÊòØ"‰ºöÊ≠ªÁöÑ"ÔºàÂá°‰∫∫ÔºâÔºåimmortalÊòØ"‰∏çÊ≠ªÁöÑ"ÔºàÁ•û‰ªôÔºâ„ÄÇmortgageÔºàÊäµÊäºË¥∑Ê¨æÔºâÂ≠óÈù¢ÊÑèÊÄùÊòØ"Ê≠ª‰∫°ÊâøËØ∫"‚Äî‚ÄîË¶Å‰πàËøòÊ∏ÖË¥∑Ê¨æÔºåË¶Å‰πàÂ§±ÂéªË¥¢‰∫ßÔºÅ', roots:['viv-','mort-','sur-'], examples:[{word:'survive',meaning:'Âπ∏Â≠òÔºàË∂ÖË∂äÊ≠ª‰∫°Ôºâ'},{word:'mortal',meaning:'Âá°‰∫∫Ôºà‰ºöÊ≠ªÁöÑÔºâ'}] },
  { day:8, theme:'Âê¶ÂÆöÂâçÁºÄ', title:'ËØ¥"‰∏ç"ÁöÑÂçÅÁßçÊñπÂºè', content:'Ëã±ËØ≠‰∏≠Ë°®Á§∫Âê¶ÂÆöÊúâÂæàÂ§öÂâçÁºÄÔºåÂêÑÊúâÂàÜÂ∑•„ÄÇun-ÊúÄÂ∏∏ËßÅÔºåÂä†Âú®Êó•ËÄ≥ÊõºËØçÂâçÔºöunhappy, unknown„ÄÇin-/im-/il-/ir-Âä†Âú®Êãâ‰∏ÅËØçÂâçÔºöimpossibleÔºà‰∏çÂèØËÉΩÔºâÔºåillegalÔºàÈùûÊ≥ïÔºâÔºåirregularÔºà‰∏çËßÑÂàôÔºâ„ÄÇ\n\ndis-Ë°®Á§∫"Áõ∏ÂèçÊñπÂêë"ÔºödisagreeÔºà‰∏çÂêåÊÑèÔºâÔºådiscoverÔºàÂèëÁé∞=ÂéªÊéâË¶ÜÁõñÁâ©Ôºâ„ÄÇËÄåanti-Êù•Ëá™Â∏åËÖäËØ≠ÔºåË°®Á§∫"ÂèçÂØπ"ÔºöantibioticÂ≠óÈù¢ÊÑèÊÄùÊòØ"ÂèçÁîüÂëΩÁöÑ"‚Äî‚ÄîÁî®Êù•ÊùÄÊ≠ªÁªÜËèåÔºÅmal-Ë°®Á§∫"ÂùèÁöÑ"ÔºömalfunctionÊòØ"ÂùèÂäüËÉΩ"=ÊïÖÈöú„ÄÇ', roots:['un-','in-','dis-','anti-','mal-'], examples:[{word:'antibiotic',meaning:'ÊäóÁîüÁ¥†ÔºàÂèçÁîüÂëΩÔºâ'},{word:'discover',meaning:'ÂèëÁé∞ÔºàÂéªÊéâË¶ÜÁõñÔºâ'}] },
  { day:9, theme:'Êâã‰∏éÂÅö', title:'manufactureÔºöÁî®ÊâãÊù•ÈÄ†', content:'manu-Êù•Ëá™Êãâ‰∏ÅËØ≠manusÔºåÊÑè‰∏∫"Êâã"„ÄÇmanufactureÊúÄÂàùÂ∞±ÊòØ"Áî®ÊâãÂà∂ÈÄ†"ÔºåÂêéÊù•ÊâçÊåáÂ∑•ÂéÇÊâπÈáèÁîü‰∫ß„ÄÇmanualÊòØ"ÊâãÂ∑•ÁöÑ"ÔºåmanuscriptÊòØ"ÊâãÂÜôÁ®ø"„ÄÇmanipulateÂéüÊÑèÊòØ"Áî®ÊâãÊìç‰Ωú"ÔºåÂêéÂºïÁî≥‰∏∫"ÊìçÁ∫µ"„ÄÇ\n\nfact-Êù•Ëá™Êãâ‰∏ÅËØ≠facereÔºåÊÑè‰∏∫"ÂÅö"„ÄÇfactoryÊòØ"ÂÅö‰∏úË•øÁöÑÂú∞Êñπ"ÔºåperfectÊòØ"ÂÆåÂÖ®ÂÅöÂ•ΩÁöÑ"ÔºåefficientÊòØ"ÊúâÊïàÂú∞ÂÅöÂá∫Êù•ÁöÑ"„ÄÇËøô‰∏§‰∏™ËØçÊ†πÂä†Âú®‰∏ÄËµ∑ÔºåÂá†‰πéË¶ÜÁõñ‰∫ÜÊâÄÊúâ‰∏é"Âà∂ÈÄ†"Áõ∏ÂÖ≥ÁöÑËØçÊ±á„ÄÇ', roots:['manu-','fact-','fic-'], examples:[{word:'manufacture',meaning:'Âà∂ÈÄ†ÔºàÊâã+ÂÅöÔºâ'},{word:'manuscript',meaning:'ÊâãÁ®øÔºàÊâã+ÂÜôÔºâ'}] },
  { day:10, theme:'ÂÖâ‰∏éÊöó', title:'illuminateÔºöËÆ©ÂÖâÁÖßËøõÊù•', content:'lumenÂú®Êãâ‰∏ÅËØ≠‰∏≠ÊÑè‰∏∫"ÂÖâ"„ÄÇilluminateÂ∞±ÊòØ"‰ΩøÂÖÖÊª°ÂÖâ"=ÁÖß‰∫Æ„ÄÅÂêØÂèë„ÄÇluminaryÊòØ"ÂèëÂÖâÁöÑ‰∫∫"=Êù∞Âá∫‰∫∫Áâ©„ÄÇlucidÊù•Ëá™luxÔºàÂÖâÔºâÔºåÊÑè‰∏∫"Ê∏ÖÊô∞ÁöÑ"‚Äî‚ÄîÂÉèÂÖâ‰∏ÄÊ†∑Êòé‰∫Æ„ÄÇtranslucentÊòØ"ÂÖâËÉΩÁ©øËøáÁöÑ"=ÂçäÈÄèÊòé„ÄÇ\n\nÊúâË∂£ÁöÑÊòØÔºåphotographÔºàÁÖßÁâáÔºâÁöÑphoto-‰πüÊòØ"ÂÖâ"ÔºåÊù•Ëá™Â∏åËÖäËØ≠„ÄÇÊâÄ‰ª•"ÊëÑÂΩ±"Âú®ËØçÊ∫ê‰∏äÂ∞±ÊòØ"Áî®ÂÖâÊù•ÂÜô"„ÄÇËÄåcinemaÊù•Ëá™Â∏åËÖäËØ≠kinemaÔºàËøêÂä®ÔºâÔºåÁîµÂΩ±Â∞±ÊòØ"ËøêÂä®ÁöÑÂõæÂÉè"„ÄÇ', roots:['lum-','luc-','photo-'], examples:[{word:'illuminate',meaning:'ÁÖß‰∫ÆÔºàËÆ©ÂÖâËøõÂÖ•Ôºâ'},{word:'translucent',meaning:'ÂçäÈÄèÊòéÔºàÂÖâÁ©øËøáÔºâ'}] },
  { day:11, theme:'Ê∞¥‰∏éÊµÅ', title:'‰ªéaquaÂà∞fluidÔºöÊ∞¥ÁöÑËØçÊ†πÂÆ∂Êóè', content:'Êãâ‰∏ÅËØ≠aquaÊÑè‰∏∫"Ê∞¥"„ÄÇaquariumÊòØ"Ê∞¥ÁöÑÂÆπÂô®"=Ê∞¥ÊóèÈ¶ÜÔºåaqueductÊòØ"ÂºïÊ∞¥ÁöÑÊ∏†ÈÅì"=Ê∞¥Ê∏†Ôºàduct=ÂºïÂØºÔºâ„ÄÇaquaticÊÑè‰∏∫"Ê∞¥ÁîüÁöÑ"„ÄÇ\n\nËÄåflu-/flux-Êù•Ëá™Êãâ‰∏ÅËØ≠fluereÔºåÊÑè‰∏∫"ÊµÅ"„ÄÇfluentÊòØ"ÊµÅÁïÖÁöÑ"ÔºàËØ≠Ë®ÄÂÉèÊ∞¥‰∏ÄÊ†∑ÊµÅÂä®ÔºâÔºåinfluenceÊòØ"ÊµÅÂÖ•"=ÂΩ±ÂìçÔºåfluctuateÊòØ"ÂÉèÊ≥¢Êµ™‰∏ÄÊ†∑ÊµÅÂä®"=Ê≥¢Âä®„ÄÇfloodÔºàÊ¥™Ê∞¥ÔºâËôΩÁÑ∂ÊãºÂÜô‰∏çÂêåÔºå‰ΩÜ‰πü‰∏éËøô‰∏™ËØçÊ†πÊúâËøú‰∫≤ÂÖ≥Á≥ª„ÄÇ', roots:['aqua-','flu-','hydr-'], examples:[{word:'aqueduct',meaning:'Ê∞¥Ê∏†ÔºàÊ∞¥+ÂºïÂØºÔºâ'},{word:'influence',meaning:'ÂΩ±ÂìçÔºàÊµÅÂÖ•Ôºâ'}] },
  { day:12, theme:'‰π¶ÂÜôËØçÊ†π', title:'graphÂíåscribÔºö‰∏§Áßç"ÂÜô"ÁöÑ‰º†Áªü', content:'Ëã±ËØ≠‰∏≠Êúâ‰∏§‰∏™Ë°®Á§∫"ÂÜô"ÁöÑÊ†∏ÂøÉËØçÊ†πÔºåÂàÜÂà´Êù•Ëá™Â∏åËÖäÂíåÊãâ‰∏ÅÔºögraph-ÔºàÂ∏åËÖäÔºâÂíåscrib-ÔºàÊãâ‰∏ÅÔºâ„ÄÇ\n\ngraph-Ë°çÁîüÂá∫ÔºöbiographyÔºà‰º†ËÆ∞=ÂÜôÁîüÂëΩÔºâÔºågeographyÔºàÂú∞ÁêÜ=ÂÜôÂú∞ÁêÉÔºâÔºåparagraphÔºàÊÆµËêΩ=ÊóÅËæπÂÜôÁöÑÔºâÔºåautographÔºà‰∫≤Á¨îÁ≠æÂêç=Ëá™Â∑±ÂÜôÁöÑÔºâ„ÄÇ\n\nscrib-Ë°çÁîüÂá∫ÔºödescribeÔºàÊèèËø∞=Âêë‰∏ãÂÜôÔºâÔºåprescribeÔºàÂºÄÂ§ÑÊñπ=È¢ÑÂÖàÂÜôÂ•ΩÔºâÔºåsubscribeÔºàËÆ¢ÈòÖ=Âú®‰∏ãÈù¢Á≠æÂêçÔºâÔºåinscriptionÔºàÈì≠Êñá=ÂàªÂÜôÂú®‰∏äÈù¢Ôºâ„ÄÇ‰∏§‰∏™ËØçÊ†πÔºåË¶ÜÁõñ‰∫ÜÂá†ÂçÅ‰∏™Â∏∏Áî®ËØçÔºÅ', roots:['graph-','scrib-','script-'], examples:[{word:'biography',meaning:'‰º†ËÆ∞ÔºàÂÜôÁîüÂëΩÔºâ'},{word:'prescribe',meaning:'ÂºÄÂ§ÑÊñπÔºàÈ¢ÑÂÖàÂÜôÔºâ'}] },
  { day:13, theme:'Â£∞Èü≥ËØçÊ†π', title:'‰ªéphoneÂà∞sonicÔºöÂ£∞Èü≥ÁöÑËØçÊ±á', content:'phone-Êù•Ëá™Â∏åËÖäËØ≠phoneÔºåÊÑè‰∏∫"Â£∞Èü≥"„ÄÇtelephoneÊòØ"ËøúÂ§ÑÁöÑÂ£∞Èü≥"ÔºåmicrophoneÊòØ"ÊîæÂ§ßÂ∞èÂ£∞Èü≥"ÔºåsymphonyÊòØ"Â£∞Èü≥Âú®‰∏ÄËµ∑"=‰∫§Âìç‰πê„ÄÇphoneticÊÑè‰∏∫"ËØ≠Èü≥ÁöÑ"„ÄÇ\n\nÊãâ‰∏ÅËØ≠ÁöÑson-‰πüË°®Á§∫"Â£∞Èü≥"„ÄÇsonataÔºàÂ•èÈ∏£Êõ≤ÔºâÊòØ"Ë¢´ÊºîÂ•èÂá∫Â£∞ÁöÑ"ÔºåresonanceÔºàÂÖ±È∏£ÔºâÊòØ"Â£∞Èü≥ÂõûÂìç"ÔºåconsonantÔºàËæÖÈü≥ÔºâÂéüÊÑèÊòØ"‰∏ÄËµ∑ÂèëÂ£∞ÁöÑ"„ÄÇultrasonicÊòØ"Ë∂ÖËøáÂ£∞Èü≥ÁöÑ"=Ë∂ÖÂ£∞Ê≥¢„ÄÇ', roots:['phon-','son-','aud-'], examples:[{word:'symphony',meaning:'‰∫§Âìç‰πêÔºà‰∏ÄËµ∑ÂèëÂ£∞Ôºâ'},{word:'resonance',meaning:'ÂÖ±È∏£ÔºàÂõûÂìçÔºâ'}] },
  { day:14, theme:'Ëµ∞‰∏éË∑Ø', title:'proceed, exceed, succeedÁöÑÁßòÂØÜ', content:'Ëøô‰∏â‰∏™Â∏∏Áî®ËØçÈÉΩÂåÖÂê´-ceed/-ced-ÔºåÊù•Ëá™Êãâ‰∏ÅËØ≠cedereÔºåÊÑè‰∏∫"Ëµ∞"„ÄÇproceedÊòØ"ÂêëÂâçËµ∞"=ÁªßÁª≠ËøõË°åÔºåexceedÊòØ"Ëµ∞Âá∫Âéª/Ë∂ÖÂá∫"=Ë∂ÖËøáÔºåsucceedÊòØ"Âú®‰∏ãÈù¢Ë∑üÁùÄËµ∞"=Ë∑üÈöè‚ÜíÊàêÂäüÔºàÊé•ÊõøÂâç‰ªªÔºâ„ÄÇ\n\nacceedÊòØ"Ëµ∞Âêë"=ÂêåÊÑèÔºåprecedeÊòØ"Ëµ∞Âú®ÂâçÈù¢"=ÂÖà‰∫éÔºårecedeÊòØ"Ëµ∞ÂõûÂéª"=ÂêéÈÄÄ„ÄÇconcedeÊòØ"‰∏ÄËµ∑Ëµ∞ÔºàËÆ©Ê≠•Ôºâ"=ÊâøËÆ§„ÄÇ‰∏Ä‰∏™ËØçÊ†πÔºåËß£ÈîÅ‰∏ÄÊï¥ÁªÑËØçÊ±áÔºÅ', roots:['ced-','cess-','ceed-'], examples:[{word:'proceed',meaning:'ÁªßÁª≠ÔºàÂêëÂâçËµ∞Ôºâ'},{word:'exceed',meaning:'Ë∂ÖËøáÔºàËµ∞Âá∫ÂéªÔºâ'}] },
  { day:15, theme:'Á†¥‰∏éÂª∫', title:'structÂíåruptÔºöÂª∫ÈÄ†‰∏éÊëßÊØÅ', content:'struct-Êù•Ëá™Êãâ‰∏ÅËØ≠struereÔºåÊÑè‰∏∫"Âª∫ÈÄ†„ÄÅÂ†ÜÂè†"„ÄÇconstructÊòØ"‰∏ÄËµ∑Âª∫ÈÄ†"ÔºåstructureÊòØ"Ë¢´Âª∫ÈÄ†ÁöÑ‰∏úË•ø"=ÁªìÊûÑÔºåinstructÊòØ"Âú®ÈáåÈù¢Âª∫ÈÄ†"=ÊïôÂØºÔºàÂú®ËÑë‰∏≠Âª∫ÈÄ†Áü•ËØÜÔºâÔºådestroyÊòØ"ÊãÜÊéâÂª∫ÈÄ†ÁöÑ"=ÊëßÊØÅ„ÄÇ\n\nrupt-Êù•Ëá™Êãâ‰∏ÅËØ≠rumpereÔºåÊÑè‰∏∫"Á†¥Ë£Ç"„ÄÇinterruptÊòØ"Âú®‰∏≠Èó¥ÊâìÁ†¥"=ÊâìÊñ≠ÔºåcorruptÊòØ"ÂÆåÂÖ®Á†¥Á¢é"=ËÖêË¥•ÔºåbankruptÊòØ"Èì∂Ë°åÊüúÂè∞Ë¢´ÊâìÁ†¥"=Á†¥‰∫ßÔºà‰∏≠‰∏ñÁ∫™Á†¥‰∫ßÁöÑÈí±Â∫Ñ‰ºöË¢´Á†∏ÂùèÊüúÂè∞ÔºâÔºåeruptÊòØ"ÂêëÂ§ñÁàÜÁ†¥"=Âñ∑Âèë„ÄÇ', roots:['struct-','rupt-','de-'], examples:[{word:'construct',meaning:'Âª∫ÈÄ†Ôºà‰∏ÄËµ∑Â†ÜÂè†Ôºâ'},{word:'interrupt',meaning:'ÊâìÊñ≠Ôºà‰∏≠Èó¥ÊâìÁ†¥Ôºâ'}] },
  { day:16, theme:'ÂøÉ‰∏éÂãá', title:'courageÔºöÂøÉ‰∏≠ÁöÑÂäõÈáè', content:'courageÔºàÂãáÊ∞îÔºâÊù•Ëá™Âì™ÈáåÔºüÊù•Ëá™Êãâ‰∏ÅËØ≠corÔºåÊÑè‰∏∫"ÂøÉ"ÔºàÊ≥ïËØ≠coeur‰πüÊòØÔºâ„ÄÇÂãáÊ∞îÂ∞±ÊòØ"ÂøÉÁöÑÂäõÈáè"„ÄÇencourageÊòØ"ÊääÂãáÊ∞îÊîæËøõÂéª"=ÈºìÂä±ÔºådiscourageÊòØ"ÊääÂãáÊ∞îÊãøËµ∞"=Ê≥ÑÊ∞î„ÄÇ\n\ncord-ÂêåÊ†∑Êù•Ëá™"ÂøÉ"ÔºöaccordÊòØ"ÂøÉÂØπÂøÉ"=‰∏ÄËá¥ÔºådiscordÊòØ"ÂøÉ‰∏çÂêà"=‰∏çÂíåÔºårecordÂéüÊÑèÊòØ"ÂÜçÊ¨°ÊîæÂÖ•ÂøÉ‰∏≠"=ËÆ∞ÂΩï„ÄÇËÄåÂ∏åËÖäËØ≠ÁöÑcardio-‰πüÊòØ"ÂøÉ"ÔºöcardiovascularÊòØ"ÂøÉËÑèÂíåË°ÄÁÆ°ÁöÑ"„ÄÇ‰∏§ÁßçËØ≠Ë®ÄÔºåÂêå‰∏ÄÈ¢óÂøÉÔºÅ', roots:['cor-','cord-','cardio-'], examples:[{word:'courage',meaning:'ÂãáÊ∞îÔºàÂøÉÁöÑÂäõÈáèÔºâ'},{word:'record',meaning:'ËÆ∞ÂΩïÔºàÂÜçÂÖ•ÂøÉ‰∏≠Ôºâ'}] },
  { day:17, theme:'Áúü‰∏éÂÅá', title:'verifyÂíåpseudoÔºöÁúüÂÆû‰∏é‰º™Ë£Ö', content:'ver-Êù•Ëá™Êãâ‰∏ÅËØ≠verusÔºåÊÑè‰∏∫"ÁúüÂÆû"„ÄÇverifyÊòØ"‰ΩøÊàê‰∏∫ÁúüÁöÑ"=Ê†∏ÂÆûÔºåverdictÊòØ"ËØ¥Âá∫ÁúüËØù"=Ë£ÅÂÜ≥Ôºàdict=ËØ¥ÔºâÔºåveritableÊÑè‰∏∫"ÂêçÂâØÂÖ∂ÂÆûÁöÑ"„ÄÇveryÔºàÈùûÂ∏∏Ôºâ‰πüÊù•Ëá™Ëøô‰∏™ËØçÊ†πÔºåÂéüÊÑèÊòØ"ÁúüÊ≠£Âú∞"„ÄÇ\n\npseudo-Êù•Ëá™Â∏åËÖäËØ≠ÔºåÊÑè‰∏∫"ÂÅá"„ÄÇpseudonymÊòØ"ÂÅáÂêçÂ≠ó"=Á¨îÂêçÔºåpseudoscienceÊòØ"ÂÅáÁßëÂ≠¶"=‰º™ÁßëÂ≠¶„ÄÇËøòÊúâcrypt-ÔºàÈöêËóèÔºâÔºöencryptÊòØ"ËóèËøõÂéª"=Âä†ÂØÜÔºåcrypticÊòØ"ÈöêÁßòÁöÑ"„ÄÇ', roots:['ver-','pseudo-','crypt-'], examples:[{word:'verify',meaning:'Ê†∏ÂÆûÔºà‰ΩøÊàêÁúüÔºâ'},{word:'pseudonym',meaning:'Á¨îÂêçÔºàÂÅáÂêçÂ≠óÔºâ'}] },
  { day:18, theme:'Â§ß‰∏éÂ∞è', title:'macroÂíåmicroÔºöÂÆáÂÆôÁöÑ‰∏§Á´Ø', content:'macro-Êù•Ëá™Â∏åËÖäËØ≠makrosÔºåÊÑè‰∏∫"Â§ß"„ÄÇmacroeconomicsÔºàÂÆèËßÇÁªèÊµéÂ≠¶ÔºâÁ†îÁ©∂"Â§ßÁªèÊµé"ÔºåmacroscopicÊòØ"Â§ßÂà∞ËÉΩÁúãËßÅÁöÑ"„ÄÇ\n\nmicro-Êù•Ëá™Â∏åËÖäËØ≠mikrosÔºåÊÑè‰∏∫"Â∞è"„ÄÇmicroscopeÊòØ"ÁúãÂ∞è‰∏úË•øÁöÑÂ∑•ÂÖ∑"ÔºåmicrophoneÊòØ"ÊîæÂ§ßÂæÆÂ∞èÂ£∞Èü≥ÁöÑ"„ÄÇÊúâË∂£ÁöÑÊòØÔºåmega-Ë°®Á§∫"Áôæ‰∏á/Â∑®Â§ß"ÔºömegabyteÊòØÁôæ‰∏áÂ≠óËäÇÔºåmegacityÊòØÂ∑®ÂûãÂüéÂ∏Ç„ÄÇËÄåmini-Êù•Ëá™Êãâ‰∏ÅËØ≠Ôºå‰πüÊòØ"Â∞è"ÔºöminimumÊòØ"ÊúÄÂ∞èÂÄº"ÔºåminiatureÂéüÊåá"Áî®Á∫¢Ëâ≤È¢úÊñôÁîªÁöÑÂ∞èÂõæ"„ÄÇ', roots:['macro-','micro-','mega-','mini-'], examples:[{word:'microscope',meaning:'ÊòæÂæÆÈïúÔºàÁúãÂ∞è‰∏úË•øÔºâ'},{word:'megabyte',meaning:'ÂÖÜÂ≠óËäÇÔºàÁôæ‰∏áÔºâ'}] },
  { day:19, theme:'Êó∂Èó¥ËØçÊ†π', title:'chronicÂíåtemporaryÔºöÊó∂Èó¥ÁöÑ‰∏§Èù¢', content:'chron-Êù•Ëá™Â∏åËÖäËØ≠chronosÔºåÊÑè‰∏∫"Êó∂Èó¥"„ÄÇchronicÊÑè‰∏∫"ÈïøÊó∂Èó¥ÁöÑ"=ÊÖ¢ÊÄßÁöÑÔºåchronicleÊòØ"ÊåâÊó∂Èó¥ËÆ∞ÂΩï"=ÁºñÂπ¥Âè≤ÔºåsynchronizeÊòØ"Âêå‰∏ÄÊó∂Èó¥"=ÂêåÊ≠•„ÄÇanachronismÊòØ"Êó∂Èó¥Èîô‰Ωç"=Êó∂‰ª£ÈîôËØØ„ÄÇ\n\ntemp-Êù•Ëá™Êãâ‰∏ÅËØ≠tempusÔºå‰πüÊòØ"Êó∂Èó¥"„ÄÇtemporaryÊòØ"ÊöÇÊó∂ÁöÑ"ÔºàÂè™ÊåÅÁª≠‰∏ÄÊÆµÊó∂Èó¥ÔºâÔºåcontemporaryÊòØ"Âêå‰∏ÄÊó∂‰ª£ÁöÑ"„ÄÇÊúâË∂£ÁöÑÊòØÔºåtempoÔºàËäÇÂ•èÔºâ‰πüÊù•Ëá™Ëøô‰∏™ËØçÊ†π‚Äî‚ÄîÈü≥‰πêÁöÑ"Êó∂Èó¥ÊÑü"„ÄÇ', roots:['chron-','temp-','ann-'], examples:[{word:'synchronize',meaning:'ÂêåÊ≠•ÔºàÂêå‰∏ÄÊó∂Èó¥Ôºâ'},{word:'contemporary',meaning:'ÂΩì‰ª£ÁöÑÔºàÂêåÊó∂‰ª£Ôºâ'}] },
  { day:20, theme:'Áü•ËØÜËØçÊ†π', title:'scienceÂíåcognitionÔºöÁü•‰∏éËØÜ', content:'sci-Êù•Ëá™Êãâ‰∏ÅËØ≠scireÔºåÊÑè‰∏∫"Áü•ÈÅì"„ÄÇscienceÊòØ"Áü•ËØÜÁöÑ‰ΩìÁ≥ª"ÔºåconsciousÊòØ"ÂíåËá™Â∑±‰∏ÄËµ∑Áü•ÈÅì"=ÊúâÊÑèËØÜÁöÑÔºåomniscientÊòØ"‰ªÄ‰πàÈÉΩÁü•ÈÅìÁöÑ"=ÂÖ®Áü•ÁöÑ„ÄÇ\n\ncogn-Êù•Ëá™Êãâ‰∏ÅËØ≠cognoscereÔºåÊÑè‰∏∫"ËÆ§ËØÜ"„ÄÇrecognizeÊòØ"ÂÜçÊ¨°ËÆ§ËØÜ"=ËÆ§Âá∫ÔºåcognitionÊòØ"ËÆ§Áü•"„ÄÇincognitoÊòØ"‰∏çË¢´ËÆ§Âá∫ÁöÑ"=ÈöêÂßìÂüãÂêç„ÄÇdiagnosisÊù•Ëá™Â∏åËÖäËØ≠ÁöÑgnos-ÔºàÁü•ÈÅìÔºâÔºådia-ÔºàÁ©øËøáÔºâÔºåÊòØ"ÁúãÁ©øÊù•ËÆ§ËØÜ"=ËØäÊñ≠„ÄÇ', roots:['sci-','cogn-','gnos-'], examples:[{word:'conscious',meaning:'ÊúâÊÑèËØÜÁöÑÔºàËá™Áü•Ôºâ'},{word:'recognize',meaning:'ËÆ§Âá∫ÔºàÂÜçÊ¨°ËÆ§ËØÜÔºâ'}] },
  { day:21, theme:'ÂäõÈáèËØçÊ†π', title:'potentÂíådynamicÔºöÂäõÈáèÁöÑÊ∫êÊ≥â', content:'pot-Êù•Ëá™Êãâ‰∏ÅËØ≠potisÔºåÊÑè‰∏∫"ÊúâËÉΩÂäõÁöÑ"„ÄÇpotentÊòØ"ÊúâÂäõÈáèÁöÑ"ÔºåpotentialÊòØ"ÊΩúÂú®ÁöÑÂäõÈáè"ÔºåomnipotentÊòØ"ÂÖ®ËÉΩÁöÑ"Ôºàomni=ÂÖ®ÈÉ®Ôºâ„ÄÇimpotentÊòØ"Êó†ÂäõÁöÑ"„ÄÇ\n\ndynam-Êù•Ëá™Â∏åËÖäËØ≠dynamisÔºåÊÑè‰∏∫"ÂäõÈáè"„ÄÇdynamicÊòØ"ÊúâÂäõÈáèÁöÑ"=Âä®ÊÄÅÁöÑÔºådynamiteÊòØ"ÊúâÁàÜÁÇ∏ÂäõÁöÑ"=ÁÇ∏ËçØÔºàËØ∫Ë¥ùÂ∞îÂèëÊòéÂπ∂ÂëΩÂêçÔºâÔºådynastyÊòØ"ÊúâÊùÉÂäõÁöÑÂÆ∂Êóè"=ÁéãÊúù„ÄÇËÉΩÈáèenergyÁöÑ-erg-‰πüÊòØ"Â∑•‰Ωú/ÂäõÈáè"ÁöÑÊÑèÊÄù„ÄÇ', roots:['pot-','dynam-','fort-'], examples:[{word:'potential',meaning:'ÊΩúÂäõÔºàÊΩúÂú®ÂäõÈáèÔºâ'},{word:'dynamite',meaning:'ÁÇ∏ËçØÔºàÂ∑®Â§ßÂäõÈáèÔºâ'}] },
  { day:22, theme:'ÊäòÂè†ËØçÊ†π', title:'complicateÔºöÊää‰∫ãÊÉÖÊäòÂè†Ëµ∑Êù•', content:'plic-/plex-/ply-Êù•Ëá™Êãâ‰∏ÅËØ≠plicareÔºåÊÑè‰∏∫"ÊäòÂè†"„ÄÇcomplicateÊòØ"‰∏ÄËµ∑ÊäòÂè†"=‰ΩøÂ§çÊùÇÔºàÊäòÂè†Â§ö‰∫ÜÂ∞±‰π±‰∫ÜÔºâÔºåcomplex‰πüÊòØ"ÁºñÁªáÂú®‰∏ÄËµ∑ÁöÑ"=Â§çÊùÇÁöÑ„ÄÇ\n\nexplicitÊòØ"Â±ïÂºÄÁöÑ"=ÊòéÁ°ÆÁöÑÔºàÊääÊäòÂè†ÁöÑÊâìÂºÄÔºâÔºåimplicitÊòØ"ÊäòÂú®ÈáåÈù¢ÁöÑ"=Âê´ËìÑÁöÑ„ÄÇapplyÊòØ"ÊäòÂè†Âà∞‰∏äÈù¢"=Áî≥ËØ∑/Â∫îÁî®ÔºåreplyÊòØ"ÊäòÂè†ÂõûÂéª"=ÂõûÂ§çÔºåmultiplyÊòØ"Â§öÊ¨°ÊäòÂè†"=‰πòÊ≥ï„ÄÇsimpleÂéüÊÑèÊòØ"Âè™Êäò‰∏ÄÊ¨°"=ÁÆÄÂçï„ÄÇ', roots:['plic-','plex-','ply-'], examples:[{word:'complicate',meaning:'‰ΩøÂ§çÊùÇÔºà‰∏ÄËµ∑ÊäòÂè†Ôºâ'},{word:'explicit',meaning:'ÊòéÁ°ÆÁöÑÔºàÂ±ïÂºÄÁöÑÔºâ'}] },
  { day:23, theme:'ÊÅêÊÉßËØçÊ†π', title:'phobiaÔºöÂ∏åËÖä‰∫∫ÁöÑÊÅêÊÉß', content:'phob-Êù•Ëá™Â∏åËÖäËØ≠phobosÔºåÊÑè‰∏∫"ÊÅêÊÉß"„ÄÇËøô‰∏™ËØçÊ†πÂàõÈÄ†‰∫ÜÂ§ßÈáèÂøÉÁêÜÂ≠¶ÊúØËØ≠ÔºöclaustrophobiaÔºàÂπΩÈó≠ÊÅêÊÉßÁóáÔºåclaustro=Â∞ÅÈó≠ÔºâÔºåarachnophobiaÔºàËúòËõõÊÅêÊÉßÁóáÔºåarachne=ËúòËõõÔºâÔºåacrophobiaÔºàÊÅêÈ´òÁóáÔºåacro=È´òÂ§ÑÔºâ„ÄÇ\n\nÊúâË∂£ÁöÑÊòØÔºåphob-ÁöÑÂèçÈù¢ÊòØphil-ÔºàÁà±Ôºâ„ÄÇbibliophileÊòØ"Áà±‰π¶ÁöÑ‰∫∫"ÔºåanglophileÊòØ"‰∫≤Ëã±ÁöÑ‰∫∫"„ÄÇxenophobiaÊòØ"ÂØπÂ§ñÊù•ËÄÖÁöÑÊÅêÊÉß"ÔºåËÄåxenophileÂàôÊòØ"ÂñúÊ¨¢Â§ñÊù•ÊñáÂåñÁöÑ‰∫∫"„ÄÇÊÅêÊÉß‰∏éÁÉ≠Áà±Ôºå‰∏ÄÁªÑËØçÊ†πÂ∞±ÊêûÂÆö„ÄÇ', roots:['phob-','phil-','xeno-'], examples:[{word:'claustrophobia',meaning:'ÂπΩÈó≠ÊÅêÊÉßÁóá'},{word:'bibliophile',meaning:'Áà±‰π¶‰∫∫'}] },
  { day:24, theme:'Ê∞ë‰∏ªËØçÊ†π', title:'democracyÔºö‰∫∫Ê∞ëÁöÑÁªüÊ≤ª', content:'demo-Êù•Ëá™Â∏åËÖäËØ≠demosÔºåÊÑè‰∏∫"‰∫∫Ê∞ë"„ÄÇdemocracyÊòØ"‰∫∫Ê∞ëÁöÑÁªüÊ≤ª"=Ê∞ë‰∏ª„ÄÇepidemicÊòØ"Âú®‰∫∫Ê∞ë‰πã‰∏≠ÁöÑ"=ÊµÅË°åÁóÖÔºàepi=Âú®‚Ä¶‰∏äÈù¢Ôºâ„ÄÇdemographicÊòØ"ÊèèÂÜô‰∫∫Ê∞ëÁöÑ"=‰∫∫Âè£ÁªüËÆ°„ÄÇ\n\ncracyÊù•Ëá™Â∏åËÖäËØ≠kratosÔºàÂäõÈáè/ÁªüÊ≤ªÔºâ„ÄÇaristocracyÊòØ"ÊúÄ‰ºòÁßÄËÄÖÁöÑÁªüÊ≤ª"=Ë¥µÊóèÂà∂ÔºåbureaucracyÊòØ"ÂäûÂÖ¨Ê°åÁöÑÁªüÊ≤ª"=ÂÆòÂÉöÂà∂Ôºàbureau=ÂäûÂÖ¨Ê°åÔºâÔºåplutocracyÊòØ"Ë¥¢ÂØåÁöÑÁªüÊ≤ª"=Ë¥¢ÈòÄÊîøÊ≤ª„ÄÇtheocracyÊòØ"Á•ûÁöÑÁªüÊ≤ª"=Á•ûÊùÉÊîøÊ≤ª„ÄÇ', roots:['demo-','cracy','arch-'], examples:[{word:'democracy',meaning:'Ê∞ë‰∏ªÔºà‰∫∫Ê∞ëÁªüÊ≤ªÔºâ'},{word:'bureaucracy',meaning:'ÂÆòÂÉöÂà∂ÔºàÊ°åÂ≠êÁªüÊ≤ªÔºâ'}] },
  { day:25, theme:'ÂèòÂåñËØçÊ†π', title:'revolutionÔºöËΩ¨ÂõûÊù•ÁöÑÂäõÈáè', content:'volv-/volut-Êù•Ëá™Êãâ‰∏ÅËØ≠volvereÔºåÊÑè‰∏∫"Âç∑„ÄÅËΩ¨"„ÄÇrevolutionÊòØ"ËΩ¨ÂõûÊù•"=Èù©ÂëΩÔºàÂ§©‰ΩìËΩ¨‰∏ÄÂúà‰πüÂè´revolutionÔºâÔºåevolutionÊòØ"Â±ïÂºÄËΩ¨Âá∫Êù•"=ËøõÂåñÔºåinvolveÊòØ"Âç∑ËøõÂéª"=Ê∂âÂèä„ÄÇ\n\nvert-/vers-Êù•Ëá™Êãâ‰∏ÅËØ≠vertereÔºå‰πüÊòØ"ËΩ¨"„ÄÇconvertÊòØ"‰∏ÄËµ∑ËΩ¨"=ËΩ¨ÂèòÔºåreverseÊòØ"ËΩ¨ÂõûÊù•"=ÂèçËΩ¨ÔºåversatileÊòØ"ËÉΩÁÅµÊ¥ªËΩ¨ÂêëÁöÑ"=Â§öÊâçÂ§öËâ∫ÔºåuniverseÊòØ"ËΩ¨Âêë‰∏Ä‰∏™ÊñπÂêë"=ÂÆáÂÆô„ÄÇcontroversyÊòØ"ËΩ¨ÂêëÂØπÁ´ãÈù¢"=‰∫âËÆÆ„ÄÇ', roots:['volv-','vert-','vers-'], examples:[{word:'revolution',meaning:'Èù©ÂëΩÔºàËΩ¨ÂõûÊù•Ôºâ'},{word:'versatile',meaning:'Â§öÊâçÂ§öËâ∫ÔºàÁÅµÊ¥ªËΩ¨ÂêëÔºâ'}] },
  { day:26, theme:'ÂàáÂâ≤ËØçÊ†π', title:'decideÔºöÂàáÊñ≠ÂÖ∂‰ªñÈÄâÊã©', content:'cid-/cis-Êù•Ëá™Êãâ‰∏ÅËØ≠caedereÔºåÊÑè‰∏∫"Âàá"„ÄÇdecideÂéüÊÑèÊòØ"ÂàáÊñ≠"‚Äî‚ÄîÂÅöÂÜ≥ÂÆöÂ∞±ÊòØÂàáÊéâÂÖ∂‰ªñÈÄâÈ°πÔºÅpreciseÊòØ"È¢ÑÂÖàÂàáÂ•ΩÁöÑ"=Á≤æÁ°ÆÁöÑÔºåconciseÊòØ"ÂàáÁü≠ÁöÑ"=ÁÆÄÊ¥ÅÁöÑÔºåincisionÊòØ"ÂàáËøõÂéª"=ÂàáÂè£„ÄÇ\n\nsect-/seg-‰πüÊòØ"Âàá"ÔºösectionÊòØ"Ë¢´ÂàáÂºÄÁöÑÈÉ®ÂàÜ"=Á´†ËäÇ/Âå∫ÂüüÔºåinsectÊòØ"Ë¢´ÂàáÂºÄÁöÑ"=ÊòÜËô´ÔºàÂõ†‰∏∫ÊòÜËô´Ë∫´‰ΩìÂÉèË¢´ÂàáÊàêÂá†ÊÆµÔºâÔºåsegmentÊòØ"ÂàáÂºÄÁöÑÈÉ®ÂàÜ"=ÁâáÊÆµÔºåbisectÊòØ"ÂàáÊàê‰∏§Âçä"=‰∫åÁ≠âÂàÜ„ÄÇ', roots:['cid-','cis-','sect-'], examples:[{word:'decide',meaning:'ÂÜ≥ÂÆöÔºàÂàáÊñ≠ÈÄâÈ°πÔºâ'},{word:'insect',meaning:'ÊòÜËô´ÔºàË¢´ÂàáÂºÄÁöÑÔºâ'}] },
  { day:27, theme:'ÊäìÂèñËØçÊ†π', title:'captureÂíåconceptÔºöÊäì‰ΩèÊÉ≥Ê≥ï', content:'cap-/cept-/ceiveÊù•Ëá™Êãâ‰∏ÅËØ≠capereÔºåÊÑè‰∏∫"ÊäìÂèñ"„ÄÇcaptureÊòØ"Êäì‰Ωè"ÔºåcapableÊòØ"ËÉΩÂ§üÊäì‰ΩèÁöÑ"=ÊúâËÉΩÂäõÁöÑ„ÄÇconceptÊòØ"‰∏ÄËµ∑Êäì‰Ωè"=Ê¶ÇÂøµÔºàÊääÊÉ≥Ê≥ïÊäìÂú®‰∏ÄËµ∑ÔºâÔºåperceiveÊòØ"ÂÆåÂÖ®Êäì‰Ωè"=ÊÑüÁü•„ÄÇ\n\nreceiveÊòØ"ÂÜçÊ¨°ÊäìÂèñ"=Êé•Êî∂ÔºådeceiveÊòØ"‰ªé‰∏ãÈù¢Êäì"=Ê¨∫È™óÔºàÂÅ∑ÂÅ∑ÊäìËµ∞‰∫ÜÁúüÁõ∏ÔºâÔºåacceptÊòØ"ÂêëÁùÄÂéªÊäì"=Êé•Âèó„ÄÇexceptionÊòØ"Ë¢´ÊãøÂá∫Êù•ÁöÑ"=‰æãÂ§ñ„ÄÇ‰∏Ä‰∏™"Êäì"ÁöÑÂä®‰ΩúÔºåË°çÁîüÂá∫ÂçÅÂá†‰∏™È´òÈ¢ëËØçÔºÅ', roots:['cap-','cept-','ceive'], examples:[{word:'concept',meaning:'Ê¶ÇÂøµÔºà‰∏ÄËµ∑Êäì‰ΩèÔºâ'},{word:'perceive',meaning:'ÊÑüÁü•ÔºàÂÆåÂÖ®Êäì‰ΩèÔºâ'}] },
  { day:28, theme:'ÂëºÂê∏ËØçÊ†π', title:'inspireÔºöÊääÁÅµÊ∞îÂê∏ËøõÊù•', content:'spir-Êù•Ëá™Êãâ‰∏ÅËØ≠spirareÔºåÊÑè‰∏∫"ÂëºÂê∏"„ÄÇinspireÂéüÊÑèÊòØ"Âê∏ÂÖ•Á•ûÁÅµÁöÑÊ∞îÊÅØ"=ÊøÄÂèëÁÅµÊÑüÔºåexpireÊòØ"ÂëºÂá∫ÊúÄÂêé‰∏ÄÂè£Ê∞î"=ËøáÊúü/Âéª‰∏ñÔºåconspireÊòØ"‰∏ÄËµ∑ÂëºÂê∏"=ÂØÜË∞ãÔºàÁßòÂØÜÂú∞ÂáëÂú®‰∏ÄËµ∑‰ΩéÂ£∞ÂïÜÈáèÔºâ„ÄÇ\n\nrespireÊòØ"ÂÜçÊ¨°ÂëºÂê∏"=ÂëºÂê∏ÔºåperspireÊòØ"ÈÄöËøáÔºàÊØõÂ≠îÔºâÂëºÂê∏"=Âá∫Ê±ó„ÄÇspiritÔºàÁ≤æÁ•ûÔºâ‰πüÊù•Ëá™Ëøô‰∏™ËØçÊ†π‚Äî‚Äî"ÁÅµÈ≠ÇÁöÑÂëºÂê∏"„ÄÇaspireÊòØ"ÂêëÁùÄÂëºÂê∏/Ê∏¥Êúõ"=ËøΩÊ±Ç„ÄÇ‰∏ÄÂè£Ê∞îÁöÑËØçÊ†πÔºåÁ´üÁÑ∂ËóèÁùÄËøô‰πàÂ§öÊïÖ‰∫ãÔºÅ', roots:['spir-','in-','ex-'], examples:[{word:'inspire',meaning:'ÊøÄÂèëÔºàÂê∏ÂÖ•ÁÅµÊ∞îÔºâ'},{word:'conspire',meaning:'ÂØÜË∞ãÔºà‰∏ÄËµ∑ÂëºÂê∏Ôºâ'}] },
  { day:29, theme:'ÊîæÁΩÆËØçÊ†π', title:'compose, expose, proposeÁöÑÂÖ±ÂêåÁßòÂØÜ', content:'pos-/pon-Êù•Ëá™Êãâ‰∏ÅËØ≠ponereÔºåÊÑè‰∏∫"ÊîæÁΩÆ"„ÄÇcomposeÊòØ"ÊîæÂú®‰∏ÄËµ∑"=‰ΩúÊõ≤/ÁªÑÊàêÔºåexposeÊòØ"ÊîæÂà∞Â§ñÈù¢"=Êö¥Èú≤ÔºåproposeÊòØ"ÊîæÂà∞ÂâçÈù¢"=ÊèêËÆÆ„ÄÇ\n\ndeposeÊòØ"‰ªé‰ΩçÁΩÆ‰∏äÊîæ‰∏ãÊù•"=ÁΩ¢ÂÖçÔºåimposeÊòØ"ÊîæÂà∞‰∏äÈù¢"=Âº∫Âä†ÔºåopposeÊòØ"ÊîæÂà∞ÂØπÈù¢"=ÂèçÂØπÔºåsupposeÊòØ"ÊîæÂú®‰∏ãÈù¢"=ÂÅáËÆæÔºà‰Ωú‰∏∫Âü∫Á°ÄÔºâ„ÄÇdepositÊòØ"Êîæ‰∏ãÊù•"=Â≠òÊ¨æ/ÊäºÈáë„ÄÇpositionÂ∞±ÊòØ"Ë¢´ÊîæÁΩÆÁöÑÁä∂ÊÄÅ"=‰ΩçÁΩÆ„ÄÇ', roots:['pos-','pon-','com-'], examples:[{word:'compose',meaning:'ÁªÑÊàêÔºàÊîæÂú®‰∏ÄËµ∑Ôºâ'},{word:'expose',meaning:'Êö¥Èú≤ÔºàÊîæÂà∞Â§ñÈù¢Ôºâ'}] },
  { day:30, theme:'ÁªºÂêàÂõûÈ°æ', title:'ËØçÊ†πÂ≠¶‰π†Ôºö‰ªéÁ¢éÁâáÂà∞‰ΩìÁ≥ª', content:'ÁªèËøá‰∏Ä‰∏™ÊúàÁöÑËØçÊ†π‰πãÊóÖÔºå‰Ω†Â∑≤ÁªèÊéåÊè°‰∫Ü‰∏Ä‰∏™Âº∫Â§ßÁöÑÂ∑•ÂÖ∑„ÄÇËÆ∞‰ΩèÂá†‰∏™Ê†∏ÂøÉÂéüÂàôÔºöÂ§ßÂ§öÊï∞Ëã±ËØ≠Â≠¶ÊúØËØçÊ±áÁî±Êãâ‰∏ÅËØ≠ÂíåÂ∏åËÖäËØ≠ËØçÊ†πÊûÑÊàê„ÄÇÂâçÁºÄÂÜ≥ÂÆöÊñπÂêëÔºàex-Âá∫, in-Ëøõ, pre-Ââç, re-ÂõûÔºâÔºåËØçÊ†πÂÜ≥ÂÆöÂê´‰πâÔºàduct-ÂºïÂØº, port-Êê∫Â∏¶, scrib-ÂÜôÔºâÔºåÂêéÁºÄÂÜ≥ÂÆöËØçÊÄßÔºà-tionÂêçËØç, -ousÂΩ¢ÂÆπËØç, -izeÂä®ËØçÔºâ„ÄÇ\n\nÊéåÊè°‰∫Ü200‰∏™Ê†∏ÂøÉËØçÊ†πÔºå‰Ω†Â∞±ËÉΩÊé®Êñ≠Âá∫10000+ÂçïËØçÁöÑÂê´‰πâ„ÄÇËøô‰∏çÊòØÊ≠ªËÆ∞Á°¨ËÉåÔºåËÄåÊòØÁêÜËß£ËØ≠Ë®ÄÁöÑÂÜÖÂú®ÈÄªËæë„ÄÇÁªßÁª≠Êé¢Á¥¢ÔºåÊØè‰∏™Êñ∞ËØçÈÉΩÊòØ‰∏Ä‰∏™Á≠âÂæÖÂèëÊéòÁöÑÊïÖ‰∫ãÔºÅ', roots:['ÊÄªÁªì','ÂâçÁºÄ+ËØçÊ†π+ÂêéÁºÄ'], examples:[{word:'unprecedented',meaning:'Âè≤Êó†Ââç‰æãÔºàun+pre+ced+ent+edÔºâ'},{word:'autobiography',meaning:'Ëá™‰º†Ôºàauto+bio+graph+yÔºâ'}] },
];


// ======================================================================
// STATE
// ======================================================================
let cards = [];
let etymologyWords = []; // saved from etymology analysis
let settings = { apiProvider:'gemini', apiModel:'gemini-2.5-flash', apiKey:'', firstUseDate:null, autoSync:false };
let reviewState = { words:[], currentIndex:0, results:[] };
let reviewRecords = {}; // wordKey -> { wordKey, word, level, nextReview, reviewCount, correctCount, wrongCount, lastReview }
const REVIEW_INTERVALS = [0, 1, 3, 7, 15, 30]; // days per level (0=new, 1-5=spaced)
let googleUser = null, accessToken = null;
let etyAnalysis = null, etyLoading = false;
let currentEtyView = 'search';
let currentCourseLevel = 'level1', currentCourseUnit = null;
let favArticles = JSON.parse(localStorage.getItem('ec_fav_articles') || '[]');

const WELCOME_GREETINGS = [
  { text: 'Hello, World ‚ú¶', sub: 'Ready to explore words today?' },
  { text: 'Welcome back ‚ú¶', sub: 'Every word has a story' },
  { text: 'Hey there ‚ú¶', sub: 'Let\'s discover something new' },
  { text: 'Good to see you ‚ú¶', sub: 'Your vocabulary journey continues' },
  { text: 'Hi, explorer ‚ú¶', sub: 'Words are waiting for you' },
];

function showWelcome() {
  const overlay = document.getElementById('welcomeOverlay');
  if (!overlay) return;
  const g = WELCOME_GREETINGS[Math.floor(Math.random() * WELCOME_GREETINGS.length)];
  overlay.querySelector('.welcome-text').textContent = g.text;
  document.getElementById('welcomeSub').textContent = g.sub;
  setTimeout(() => {
    overlay.classList.add('fade-out');
    setTimeout(() => overlay.remove(), 800);
  }, 2800);
}

function toggleFavArticle(day) {
  const idx = favArticles.indexOf(day);
  if (idx >= 0) favArticles.splice(idx, 1);
  else favArticles.push(day);
  localStorage.setItem('ec_fav_articles', JSON.stringify(favArticles));
}

function showFavArticle(day) {
  const article = DAILY_ARTICLES.find(a => a.day === day);
  if (!article) return;
  const isFaved = favArticles.includes(day);
  const el = document.getElementById('etySearchView');
  el.innerHTML = `
    <button onclick="renderEtySearchView()" style="padding:8px 14px;font-size:13px;color:var(--text-secondary);background:var(--warm-gray);border:none;border-radius:8px;cursor:pointer;margin-bottom:12px">‚Üê ËøîÂõû</button>
    <div class="daily-article">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <div class="article-badge">üìÖ ${article.theme}</div>
        <button class="article-fav-btn ${isFaved ? 'faved' : ''}" onclick="toggleFavArticle(${day});showFavArticle(${day})">
          ${isFaved ? '‚ù§Ô∏è Â∑≤Êî∂Ëóè' : 'ü§ç Êî∂Ëóè'}
        </button>
      </div>
      <h3 class="article-title">${article.title}</h3>
      <p class="article-content">${article.content}</p>
      <div class="article-roots">${article.roots.map(r=>`<span class="article-root-tag">${r}</span>`).join('')}</div>
      <div class="article-examples">${article.examples.map(ex=>`<button class="article-word-btn" onclick="etySearchWord('${ex.word}')"><span class="article-word-text">${ex.word}</span><span class="article-word-meaning">${ex.meaning}</span></button>`).join('')}</div>
    </div>`;
}

// ======================================================================
// IndexedDB
// ======================================================================
const DB_NAME = 'EnglishCollectorDB';
let db;

async function initDB() {
  return new Promise((resolve, reject) => {
    const req = indexedDB.open(DB_NAME, 3);
    req.onerror = (e) => { console.error('DB open error:', e); reject(req.error); };
    req.onsuccess = () => { db = req.result; console.log('DB opened, version:', db.version); resolve(db); };
    req.onblocked = () => {
      console.warn('DB upgrade blocked - trying without upgrade');
      showToast('Êï∞ÊçÆÂ∫ìÂçáÁ∫ß‰∏≠ÔºåËØ∑ÂÖ≥Èó≠ÂÖ∂‰ªñÊ†áÁ≠æÈ°µÂêéÂà∑Êñ∞', 'error');
      // Try opening without version upgrade as fallback
      const fallback = indexedDB.open(DB_NAME);
      fallback.onsuccess = () => { db = fallback.result; console.log('DB fallback opened, version:', db.version); resolve(db); };
      fallback.onerror = () => reject(fallback.error);
    };
    req.onupgradeneeded = (e) => {
      const d = e.target.result;
      console.log('DB upgrading from v' + e.oldVersion + ' to v' + e.newVersion);
      if (!d.objectStoreNames.contains('cards')) d.createObjectStore('cards', { keyPath: 'id' });
      if (!d.objectStoreNames.contains('settings')) d.createObjectStore('settings', { keyPath: 'key' });
      if (!d.objectStoreNames.contains('etymologyWords')) d.createObjectStore('etymologyWords', { keyPath: 'word' });
      if (!d.objectStoreNames.contains('reviewRecords')) d.createObjectStore('reviewRecords', { keyPath: 'wordKey' });
    };
  });
}

function ensureDB() { if (!db) throw new Error('Êï∞ÊçÆÂ∫ìÊú™Â∞±Áª™ÔºåËØ∑Âà∑Êñ∞È°µÈù¢'); }

async function dbGetAll(store) {
  ensureDB();
  return new Promise((r, e) => { const q = db.transaction([store],'readonly').objectStore(store).getAll(); q.onsuccess = () => r(q.result||[]); q.onerror = () => e(q.error); });
}
async function dbGet(store, key) {
  ensureDB();
  return new Promise((r, e) => { const q = db.transaction([store],'readonly').objectStore(store).get(key); q.onsuccess = () => r(q.result); q.onerror = () => e(q.error); });
}
async function dbPut(store, data) {
  ensureDB();
  return new Promise((r, e) => { const q = db.transaction([store],'readwrite').objectStore(store).put(data); q.onsuccess = () => r(); q.onerror = () => e(q.error); });
}
async function dbDelete(store, key) {
  ensureDB();
  return new Promise((r, e) => { const q = db.transaction([store],'readwrite').objectStore(store).delete(key); q.onsuccess = () => r(); q.onerror = () => e(q.error); });
}

async function loadData() {
  const hasStore = (name) => db.objectStoreNames.contains(name);
  
  cards = hasStore('cards') ? await dbGetAll('cards') : [];
  cards.sort((a,b) => new Date(b.createdAt) - new Date(a.createdAt));
  etymologyWords = hasStore('etymologyWords') ? await dbGetAll('etymologyWords') : [];
  // Load review records into memory map
  reviewRecords = {};
  if (hasStore('reviewRecords')) {
    const recs = await dbGetAll('reviewRecords');
    recs.forEach(r => { reviewRecords[r.wordKey] = r; });
  }
  const saved = hasStore('settings') ? await dbGet('settings', 'main') : null;
  if (saved) settings = { ...settings, ...saved.value };
  document.getElementById('apiProvider').value = settings.apiProvider;
  document.getElementById('apiKey').value = settings.apiKey;
  document.getElementById('autoSyncToggle').checked = settings.autoSync;
  updateModelOptions();
  console.log('Data loaded: cards='+cards.length+', etymWords='+etymologyWords.length+', reviews='+Object.keys(reviewRecords).length);
}

async function saveCardToDB(card) {
  await dbPut('cards', card);
  const idx = cards.findIndex(c => c.id === card.id);
  if (idx >= 0) cards[idx] = card; else cards.unshift(card);
}
async function deleteCardFromDB(cardId) {
  await dbDelete('cards', cardId);
  cards = cards.filter(c => c.id !== cardId);
}
async function saveEtyWord(wordData) {
  await dbPut('etymologyWords', wordData);
  const idx = etymologyWords.findIndex(w => w.word === wordData.word);
  if (idx >= 0) etymologyWords[idx] = wordData; else etymologyWords.push(wordData);
}
async function deleteEtyWord(word) {
  await dbDelete('etymologyWords', word);
  etymologyWords = etymologyWords.filter(w => w.word !== word);
}
async function saveSettingsToDB() {
  await dbPut('settings', { key:'main', value: settings });
}

// ======================================================================
// SIDEBAR & AUTH
// ======================================================================
function openSidebar() { document.getElementById('sidebar').classList.add('active'); document.getElementById('sidebarOverlay').classList.add('active'); }
function closeSidebar() { document.getElementById('sidebar').classList.remove('active'); document.getElementById('sidebarOverlay').classList.remove('active'); }

function handleGoogleAuth() {
  if (googleUser) {
    if (confirm('Á°ÆÂÆöË¶ÅÈÄÄÂá∫ÁôªÂΩïÂêóÔºü')) { googleUser=null; accessToken=null; localStorage.removeItem('ec_access_token'); localStorage.removeItem('ec_user'); updateUserUI(); showToast('Â∑≤ÈÄÄÂá∫ÁôªÂΩï','success'); }
    return;
  }
  const client = google.accounts.oauth2.initTokenClient({
    client_id: GOOGLE_CLIENT_ID,
    scope: 'https://www.googleapis.com/auth/drive.file https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email',
    callback: async (response) => { if (response.access_token) { accessToken = response.access_token; localStorage.setItem('ec_access_token', accessToken); await fetchUserInfo(); if (settings.autoSync) await syncFromCloud(); } },
  });
  client.requestAccessToken();
}

async function fetchUserInfo() {
  try {
    const res = await fetch('https://www.googleapis.com/oauth2/v2/userinfo', { headers: { 'Authorization': `Bearer ${accessToken}` } });
    if (!res.ok) throw new Error('Token expired');
    googleUser = await res.json();
    localStorage.setItem('ec_user', JSON.stringify(googleUser));
    updateUserUI(); showToast('ÁôªÂΩïÊàêÂäüÔºÅ','success');
  } catch(e) { accessToken=null; localStorage.removeItem('ec_access_token'); localStorage.removeItem('ec_user'); updateUserUI(); }
}

function updateUserUI() {
  const avatar=document.getElementById('userAvatar'), name=document.getElementById('userName'), email=document.getElementById('userEmail');
  const dot=document.getElementById('syncDot'), text=document.getElementById('syncStatusText');
  if (googleUser) {
    avatar.innerHTML = googleUser.picture ? `<img src="${googleUser.picture}" alt="">` : '<svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"/></svg>';
    name.textContent = googleUser.name||'Áî®Êà∑'; email.textContent = googleUser.email||''; dot.classList.add('synced'); text.textContent = 'Â∑≤ËøûÊé• Google';
  } else {
    avatar.innerHTML = '<svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"/></svg>';
    name.textContent = 'Êú™ÁôªÂΩï'; email.textContent = 'ÁÇπÂáªÁôªÂΩï Google ÂêåÊ≠•'; dot.classList.remove('synced'); text.textContent = 'Êú¨Âú∞Â≠òÂÇ®';
  }
}

// ======================================================================
// GOOGLE DRIVE SYNC
// ======================================================================
async function findDriveFile() {
  const res = await fetch(`https://www.googleapis.com/drive/v3/files?q=name='${DRIVE_FILE_NAME}' and trashed=false&fields=files(id,name)`, { headers: { 'Authorization': `Bearer ${accessToken}` } });
  if (!res.ok) throw new Error('Failed to search files');
  const data = await res.json();
  return data.files?.length > 0 ? data.files[0].id : null;
}

async function syncToCloud() {
  if (!accessToken) { showToast('ËØ∑ÂÖàÁôªÂΩï Google','error'); return false; }
  const freshCards = await dbGetAll('cards');
  const freshEtyWords = await dbGetAll('etymologyWords');
  const freshReviewRecs = await dbGetAll('reviewRecords');
  if (freshCards.length === 0 && freshEtyWords.length === 0) { showToast('Êú¨Âú∞Ê≤°ÊúâÊï∞ÊçÆ','error'); return false; }
  const dot=document.getElementById('syncDot'), text=document.getElementById('syncStatusText');
  dot.classList.remove('synced'); dot.classList.add('syncing'); text.textContent = 'ÂêåÊ≠•‰∏≠...';
  try {
    const payload = JSON.stringify({ version:'2.1.0', syncDate:new Date().toISOString(), cards:freshCards, etymologyWords:freshEtyWords, reviewRecords:freshReviewRecs, settings:{...settings, apiKey:''} });
    let fileId = await findDriveFile();
    let res;
    if (fileId) {
      res = await fetch(`https://www.googleapis.com/upload/drive/v3/files/${fileId}?uploadType=media`, { method:'PATCH', headers:{ 'Authorization':`Bearer ${accessToken}`, 'Content-Type':'application/json' }, body:payload });
    } else {
      const form = new FormData();
      form.append('metadata', new Blob([JSON.stringify({ name:DRIVE_FILE_NAME, mimeType:'application/json' })], { type:'application/json' }));
      form.append('file', new Blob([payload], { type:'application/json' }));
      res = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', { method:'POST', headers:{ 'Authorization':`Bearer ${accessToken}` }, body:form });
    }
    if (!res.ok) throw new Error('Upload failed');
    cards = freshCards; etymologyWords = freshEtyWords;
    dot.classList.remove('syncing'); dot.classList.add('synced'); text.textContent = 'Â∑≤ÂêåÊ≠•';
    showToast(`Â∑≤ÂêåÊ≠• ${freshCards.length} Êù°Êî∂Ëóè + ${freshEtyWords.length} ‰∏™ËØçÊ±á`, 'success');
    return true;
  } catch(e) { dot.classList.remove('syncing'); text.textContent = 'ÂêåÊ≠•Â§±Ë¥•'; showToast('ÂêåÊ≠•Â§±Ë¥•: '+e.message,'error'); return false; }
}

async function syncFromCloud() {
  if (!accessToken) { showToast('ËØ∑ÂÖàÁôªÂΩï Google','error'); return; }
  try {
    showToast('Ê≠£Âú®‰ªé‰∫ëÁ´ØËé∑Âèñ...','');
    const fileId = await findDriveFile();
    if (!fileId) { showToast('‰∫ëÁ´ØÊ≤°ÊúâÂ§á‰ªΩ','error'); return; }
    const res = await fetch(`https://www.googleapis.com/drive/v3/files/${fileId}?alt=media`, { headers:{ 'Authorization':`Bearer ${accessToken}` } });
    if (!res.ok) throw new Error('‰∏ãËΩΩÂ§±Ë¥•');
    const data = await res.json();
    // Merge cards
    if (data.cards?.length) {
      const map = new Map(cards.map(c=>[c.id,c]));
      data.cards.forEach(c => { const ex=map.get(c.id); if(!ex||new Date(c.createdAt)>new Date(ex.createdAt)) map.set(c.id,c); });
      for (const card of map.values()) await saveCardToDB(card);
      cards = Array.from(map.values()).sort((a,b)=>new Date(b.createdAt)-new Date(a.createdAt));
    }
    // Merge etymology words
    if (data.etymologyWords?.length) {
      for (const w of data.etymologyWords) await saveEtyWord(w);
    }
    // Merge review records
    if (data.reviewRecords?.length) {
      for (const r of data.reviewRecords) {
        const existing = reviewRecords[r.wordKey];
        if (!existing || r.reviewCount > existing.reviewCount) {
          reviewRecords[r.wordKey] = r;
          await dbPut('reviewRecords', r);
        }
      }
    }
    renderCards(); updateStats();
    showToast(`Â∑≤ÊÅ¢Â§ç ${cards.length} Êù°Êî∂Ëóè`, 'success');
  } catch(e) { showToast('ÊÅ¢Â§çÂ§±Ë¥•: '+e.message,'error'); }
}

async function manualSync() {
  if (!accessToken) { showToast('ËØ∑ÂÖàÁôªÂΩï Google','error'); return; }
  closeSidebar();
  const localCards = await dbGetAll('cards');
  if (localCards.length > 0) await syncToCloud(); else { showToast('Êú¨Âú∞Êó†Êï∞ÊçÆÔºåÂ∞ùËØïÊÅ¢Â§ç...',''); await syncFromCloud(); }
}

function toggleAutoSync() { settings.autoSync = document.getElementById('autoSyncToggle').checked; saveSettingsToDB(); showToast(settings.autoSync?'Â∑≤ÂºÄÂêØËá™Âä®ÂêåÊ≠•':'Â∑≤ÂÖ≥Èó≠Ëá™Âä®ÂêåÊ≠•','success'); }

// ======================================================================
// SPEECH
// ======================================================================
function speakWord(word) {
  if (!word) return;
  window.speechSynthesis.cancel();
  const u = new SpeechSynthesisUtterance(word); u.lang='en-US'; u.rate=0.8;
  const v = window.speechSynthesis.getVoices().find(v=>v.lang.startsWith('en'));
  if (v) u.voice = v;
  window.speechSynthesis.speak(u);
}

// ======================================================================
// TAB SWITCHING
// ======================================================================
function switchTab(tab) {
  document.querySelectorAll('.nav-item').forEach(i => i.classList.toggle('active', i.dataset.tab===tab));
  document.getElementById('tabCollection').classList.toggle('active', tab==='collection');
  document.getElementById('tabEtymology').classList.toggle('active', tab==='etymology');
  document.getElementById('tabReview').classList.toggle('active', tab==='review');
  document.getElementById('tabSettings').classList.toggle('active', tab==='settings');
  // Show header & quick input only for collection
  document.getElementById('mainHeader').classList.toggle('hide', tab!=='collection');
  document.getElementById('quickInputWrapper').classList.toggle('hide', tab!=='collection');
  if (tab==='review') initReview();
  if (tab==='settings') updateStats();
  if (tab==='etymology') renderEtyView();
}

// ======================================================================
// COLLECTION (TAB 1)
// ======================================================================
function getRelativeDate(dateStr) {
  const d = new Date(dateStr);
  const now = new Date();
  const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
  const cardDay = new Date(d.getFullYear(), d.getMonth(), d.getDate());
  const diffDays = Math.floor((today - cardDay) / 86400000);
  if (diffDays === 0) return '‰ªäÂ§©';
  if (diffDays === 1) return 'Êò®Â§©';
  if (diffDays < 7) return `${diffDays}Â§©Ââç`;
  if (diffDays < 30) return `${Math.floor(diffDays/7)}Âë®Ââç`;
  return d.toLocaleDateString('zh-CN', { month:'short', day:'numeric' });
}

function getDateGroup(dateStr) {
  const d = new Date(dateStr);
  const now = new Date();
  const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
  const cardDay = new Date(d.getFullYear(), d.getMonth(), d.getDate());
  const diffDays = Math.floor((today - cardDay) / 86400000);
  if (diffDays === 0) return 'üìå ‰ªäÂ§©';
  if (diffDays === 1) return 'üìå Êò®Â§©';
  if (diffDays < 7) return 'üìé Êú¨Âë®';
  if (diffDays < 30) return 'üìé Êú¨Êúà';
  return 'üì¶ Êõ¥Êó©';
}

let timelineView = false;

function toggleTimelineView() {
  timelineView = !timelineView;
  renderCards();
}

function renderCards() {
  const grid = document.getElementById('cardGrid');
  const empty = document.getElementById('emptyState');
  const query = document.getElementById('searchInput').value.toLowerCase();
  const filtered = cards.filter(c =>
    c.content.toLowerCase().includes(query) || c.translation?.toLowerCase().includes(query) || c.keywords?.some(k=>k.word.toLowerCase().includes(query))
  );
  if (filtered.length===0) { grid.innerHTML=''; empty.classList.remove('hide'); return; }
  empty.classList.add('hide');
  
  if (timelineView) {
    // Timeline view with date groups
    grid.style.columnCount = '1';
    grid.style.maxWidth = '600px';
    let lastGroup = '';
    grid.innerHTML = filtered.map(card => {
      const group = getDateGroup(card.createdAt);
      const rel = getRelativeDate(card.createdAt);
      let header = '';
      if (group !== lastGroup) {
        lastGroup = group;
        const count = filtered.filter(c => getDateGroup(c.createdAt) === group).length;
        header = `<div class="date-group-header"><div class="date-group-dot"></div><span class="date-group-label">${group}</span><span class="date-group-count">${count}Êù°</span></div>`;
      }
      return header + `
        <div class="card" onclick="openDetailModal('${card.id}')" style="margin-bottom:10px">
          <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:8px">
            <div class="card-content" style="-webkit-line-clamp:3;flex:1">${esc(card.content)}</div>
            <span style="font-size:10px;color:var(--text-muted);white-space:nowrap;padding-top:2px">${rel}</span>
          </div>
          ${card.keywords?.length ? `<div class="card-keywords">${card.keywords.slice(0,3).map(k=>`<span class="keyword-tag">${esc(k.word)}</span>`).join('')}</div>` : ''}
        </div>`;
    }).join('');
  } else {
    // Masonry view with date labels
    grid.style.columnCount = '';
    grid.style.maxWidth = '';
    grid.innerHTML = filtered.map(card => {
      const rel = getRelativeDate(card.createdAt);
      return `<div class="card" onclick="openDetailModal('${card.id}')">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
          <span style="font-size:10px;color:var(--text-muted)">${rel}</span>
        </div>
        <div class="card-content">${esc(card.content)}</div>
        ${card.keywords?.length ? `<div class="card-keywords">${card.keywords.slice(0,3).map(k=>`<span class="keyword-tag">${esc(k.word)}</span>`).join('')}</div>` : ''}
      </div>`;
    }).join('');
  }
}

function openDetailModal(cardId) {
  const card = cards.find(c=>c.id===cardId);
  if (!card) return;
  const tc = card.type==='word'?'type-word':card.type==='sentence'?'type-sentence':'type-paragraph';
  const tl = card.type==='word'?'ËØç':card.type==='sentence'?'Âè•':'ÊÆµ';
  const date = new Date(card.createdAt).toLocaleDateString('zh-CN');
  let kwHtml = '';
  if (card.keywords?.length) {
    kwHtml = `<div class="keywords-section"><div class="keywords-title"><div class="keywords-title-bar"></div><span class="keywords-title-text">ÈáçÁÇπËØçÊ±á</span></div>
      <div class="keywords-list">${card.keywords.map((k,i)=>`<button class="keyword-btn ${i===0?'active':''}" onclick="showKeywordEtymology('${cardId}',${i})">${esc(k.word)}</button>`).join('')}</div></div>
      <div class="etymology-box" id="etymologyBox">${renderKwEtymology(card.keywords[0])}</div>`;
  }
  document.getElementById('detailBody').innerHTML = `
    <div class="detail-header"><div class="detail-meta"><span class="type-dot ${tc}"></span><span class="detail-date">${tl} ¬∑ ${date}</span></div>
      <button class="modal-close" onclick="closeDetailModal()"><svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg></button></div>
    <p class="detail-content">${esc(card.content)}</p>
    <p class="detail-translation">${esc(card.translation||'')}</p>
    ${kwHtml}
    <div class="add-modal-actions">
      <button class="btn btn-secondary" onclick="deleteCard('${cardId}')">Âà†Èô§</button>
      <button class="btn btn-primary" onclick="exportSingleAnki('${cardId}')">ÂØºÂá∫ Anki</button>
    </div>`;
  document.getElementById('detailModal').classList.add('active');
}

function renderKwEtymology(kw) {
  if (!kw) return '';
  return `<div class="etymology-header"><div class="etymology-word">${esc(kw.word)}</div>
    <button class="speak-btn" onclick="speakWord('${esc(kw.word)}')">üîä</button></div>
    ${kw.phonetic?`<div class="etymology-phonetic">${esc(kw.phonetic)}</div>`:''}
    <div class="etymology-item"><span class="etymology-label">ÊûÑËØç ¬∑ </span><span class="etymology-value">${esc(kw.roots||'-')}</span></div>
    <div class="etymology-item"><span class="etymology-label">Êù•Ê∫ê ¬∑ </span><span class="etymology-value">${esc(kw.origin||'-')}</span></div>
    <div class="etymology-item"><span class="etymology-label">Èáä‰πâ ¬∑ </span><span class="etymology-value">${esc(kw.meaning||'-')}</span></div>
    <button onclick="jumpToEtymology('${esc(kw.word)}')" style="margin-top:12px;width:100%;padding:10px;background:var(--accent-light);color:var(--accent);border:1px solid rgba(232,97,44,0.2);border-radius:8px;font-size:13px;font-weight:500;cursor:pointer">üß¨ Ê∑±ÂÖ•ÂàÜÊûêËØçÊ†πËØçÊ∫ê ‚Üí</button>`;
}

function jumpToEtymology(word) {
  closeDetailModal();
  switchTab('etymology');
  setTimeout(() => {
    const input = document.getElementById('etySearchInput');
    if (input) { input.value = word; }
    etySearchWord(word);
  }, 200);
}

function showKeywordEtymology(cardId, idx) {
  const card = cards.find(c=>c.id===cardId);
  if (!card?.keywords) return;
  document.querySelectorAll('.keyword-btn').forEach((b,i)=>b.classList.toggle('active',i===idx));
  document.getElementById('etymologyBox').innerHTML = renderKwEtymology(card.keywords[idx]);
}

function closeDetailModal() { document.getElementById('detailModal').classList.remove('active'); }
function openAddModal() { document.getElementById('addModal').classList.add('active'); document.getElementById('addInput').focus(); }
function closeAddModal() { document.getElementById('addModal').classList.remove('active'); document.getElementById('addInput').value=''; }

async function saveCard() {
  const content = document.getElementById('addInput').value.trim();
  if (!content) return;
  if (!settings.apiKey) { showToast('ËØ∑ÂÖàÂú®ËÆæÁΩÆ‰∏≠Â°´ÂÜô API Key','error'); return; }
  const btn = document.getElementById('saveBtn');
  btn.disabled = true;
  document.getElementById('saveBtnText').innerHTML = '<div class="spinner"></div>';
  try {
    const analysis = await callAI(buildCollectionPrompt(content));
    const wc = content.split(/\s+/).length;
    const type = wc<=3?'word':content.split(/[.!?]/).filter(s=>s.trim()).length<=1?'sentence':'paragraph';
    const card = { id:'card_'+Date.now(), content, type, translation:analysis.translation, keywords:analysis.keywords, createdAt:new Date().toISOString() };
    await saveCardToDB(card);
    if (!settings.firstUseDate) { settings.firstUseDate = new Date().toISOString(); await saveSettingsToDB(); }
    renderCards(); updateStats(); closeAddModal(); showToast('‰øùÂ≠òÊàêÂäüÔºÅ','success');
    if (settings.autoSync && accessToken) syncToCloud();
  } catch(e) { showToast('‰øùÂ≠òÂ§±Ë¥•: '+e.message,'error'); }
  finally { btn.disabled=false; document.getElementById('saveBtnText').textContent='‰øùÂ≠ò'; }
}

async function deleteCard(cardId) {
  if (!confirm('Á°ÆÂÆöÂà†Èô§Ôºü')) return;
  await deleteCardFromDB(cardId); renderCards(); updateStats(); closeDetailModal(); showToast('Â∑≤Âà†Èô§','success');
  if (settings.autoSync && accessToken) syncToCloud();
}

function handleQuickInput(e) {
  if (e.key==='Enter') {
    const c = document.getElementById('quickInput').value.trim();
    if (c) { document.getElementById('addInput').value=c; document.getElementById('quickInput').value=''; openAddModal(); saveCard(); }
  }
}
function handleSearch() { renderCards(); }

// ======================================================================
// ETYMOLOGY TAB (TAB 2)
// ======================================================================
function switchEtyView(view) {
  currentEtyView = view;
  document.querySelectorAll('.ety-sub-btn').forEach(b=>b.classList.toggle('active',b.dataset.view===view));
  document.getElementById('etySearchView').classList.toggle('hide',view!=='search');
  document.getElementById('etyExploreView').classList.toggle('hide',view!=='explore');
  document.getElementById('etyCourseView').classList.toggle('hide',view!=='course');
  renderEtyView();
}

function renderEtyView() {
  if (currentEtyView==='search') renderEtySearchView();
  else if (currentEtyView==='explore') renderEtyExploreView();
  else if (currentEtyView==='course') renderEtyCourseView();
}

// --- Search View ---
function renderEtySearchView() {
  const el = document.getElementById('etySearchView');
  if (etyAnalysis) { renderEtyResult(el); return; }
  
  // Search history
  const history = JSON.parse(localStorage.getItem('ety_search_history') || '[]');
  const historyHtml = history.length > 0 ? `
    <div style="margin-bottom:16px">
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
        <span style="font-size:12px;color:var(--text-muted)">ÊúÄËøëÊêúÁ¥¢</span>
        <span style="font-size:11px;color:var(--accent);background:var(--accent-light);padding:2px 8px;border-radius:10px">Â∑≤ÁºìÂ≠ò ${etymologyWords.length} ËØç</span>
      </div>
      <div style="display:flex;flex-wrap:wrap;gap:6px">
        ${history.slice(0, 10).map(w => {
          const isCached = etymologyWords.some(ew => ew.word.toLowerCase() === w.toLowerCase());
          return `<button onclick="etySearchWord('${esc(w)}')" style="padding:6px 12px;font-size:12px;background:${isCached ? 'var(--accent-light)' : 'white'};color:${isCached ? 'var(--accent)' : 'var(--text-secondary)'};border:1px solid ${isCached ? 'rgba(232,97,44,0.2)' : 'var(--border)'};border-radius:16px;cursor:pointer">${esc(w)} ${isCached ? '‚úì' : ''}</button>`;
        }).join('')}
      </div>
    </div>` : '';
  
  // Daily article
  const todayDate = new Date().getDate(); // 1-31
  const article = DAILY_ARTICLES.find(a => a.day === todayDate) || DAILY_ARTICLES[todayDate % DAILY_ARTICLES.length];
  const isFaved = favArticles.includes(article.day);
  
  // Favorites section
  const favsHtml = favArticles.length > 0 ? `
    <div style="margin-bottom:16px">
      <button class="fav-articles-toggle" onclick="document.getElementById('favList').classList.toggle('hide')">
        ‚ù§Ô∏è Êî∂ËóèÁöÑÊñáÁ´† (${favArticles.length})
      </button>
      <div id="favList" class="hide">
        ${favArticles.map(day => {
          const a = DAILY_ARTICLES.find(x => x.day === day);
          return a ? `<div class="fav-article-card" onclick="showFavArticle(${day})">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <span style="font-size:13px;font-weight:500;color:var(--text-primary)">${a.title}</span>
              <span style="font-size:11px;color:var(--text-muted)">${a.theme}</span>
            </div>
          </div>` : '';
        }).join('')}
      </div>
    </div>` : '';
  
  el.innerHTML = historyHtml + favsHtml + `
    <div class="daily-article">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <div class="article-badge">üìÖ ‰ªäÊó•ËØçÊ∫ê ¬∑ ${article.theme}</div>
        <button class="article-fav-btn ${isFaved ? 'faved' : ''}" onclick="toggleFavArticle(${article.day});renderEtySearchView()">
          ${isFaved ? '‚ù§Ô∏è Â∑≤Êî∂Ëóè' : 'ü§ç Êî∂Ëóè'}
        </button>
      </div>
      <h3 class="article-title">${article.title}</h3>
      <p class="article-content">${article.content}</p>
      <div class="article-roots">${article.roots.map(r=>`<span class="article-root-tag">${r}</span>`).join('')}</div>
      <div class="article-examples">${article.examples.map(ex=>`<button class="article-word-btn" onclick="etySearchWord('${ex.word}')"><span class="article-word-text">${ex.word}</span><span class="article-word-meaning">${ex.meaning}</span></button>`).join('')}</div>
    </div>`;
}

function renderEtyResult(el) {
  const a = etyAnalysis;
  const isCached = etymologyWords.some(w=>w.word===a.word);
  el.innerHTML = `
    <div class="ety-result">
      <div class="ety-result-header">
        <div style="display:flex;align-items:center;gap:12px;flex-wrap:wrap">
          <span class="ety-result-word">${esc(a.word)}</span>
          <button class="speak-btn" onclick="speakWord('${esc(a.word)}')">üîä</button>
          ${isCached ? '<span style="font-size:11px;padding:3px 8px;background:rgba(76,175,80,0.1);color:var(--success);border-radius:10px">‚úì Â∑≤ÁºìÂ≠ò</span>' : ''}
        </div>
        <p class="ety-result-phonetic">${esc(a.phonetic||'')}</p>
        <p class="ety-result-meaning">${esc(a.meaning||'')}</p>
        <div class="ety-result-actions">
          <button class="btn btn-secondary btn-small" onclick="etyAnalysis=null;renderEtySearchView()">‚Üê ËøîÂõû</button>
          <button class="btn btn-secondary btn-small" onclick="removeEtyCache('${esc(a.word)}')">Ê∏ÖÈô§ÁºìÂ≠ò</button>
        </div>
      </div>
      ${a.roots?.length?`<div class="ety-card"><div class="ety-card-title"><span>üß¨</span> ËØçÊ†πÊãÜËß£</div>
        ${a.roots.map(r=>`<div class="ety-root-item"><span class="ety-root-part">${esc(r.part)}</span><button class="speak-btn" style="width:28px;height:28px;font-size:12px" onclick="speakWord('${esc(r.part.replace(/[-]/g,''))}')">üîä</button><span class="ety-root-origin">${esc(r.origin)}</span><span class="ety-root-meaning">‚Üí ${esc(r.meaning)}</span></div>`).join('')}</div>`:''}
      ${a.etymology_story?`<div class="ety-card"><div class="ety-card-title"><span>üìñ</span> ËØçÊ∫êÊïÖ‰∫ã</div><p class="ety-story">${esc(a.etymology_story)}</p>${a.memory_tip?`<div class="ety-memory-tip">üí° ${esc(a.memory_tip)}</div>`:''}</div>`:''}
      ${a.examples?.length?`<div class="ety-card"><div class="ety-card-title"><span>üìù</span> ‰æãÂè•</div>
        ${a.examples.map(ex=>`<div class="ety-example"><div class="ety-example-en"><button class="speak-btn" style="width:24px;height:24px;font-size:11px;flex-shrink:0" onclick="speakWord(\`${esc(ex.sentence)}\`)">üîä</button>${esc(ex.sentence)}</div><div class="ety-example-cn">${esc(ex.translation)}</div></div>`).join('')}</div>`:''}
      ${a.related_words?.length?`<div class="ety-related"><span style="font-size:13px;color:var(--text-muted)">Áõ∏ÂÖ≥ËØçÊ±áÔºö</span>${a.related_words.map(w=>`<button class="ety-related-tag" onclick="etySearchWord('${esc(w)}')">${esc(w)}</button>`).join('')}</div>`:''}
    </div>`;
}

async function removeEtyCache(word) {
  await deleteEtyWord(word);
  etyAnalysis = null;
  renderEtySearchView();
  showToast('Â∑≤Ê∏ÖÈô§ÁºìÂ≠ò','success');
}

async function etySearch() {
  const word = document.getElementById('etySearchInput').value.trim();
  if (!word) return;
  etySearchWord(word);
}

async function etySearchWord(word) {
  if (!settings.apiKey) { showToast('ËØ∑ÂÖàÂú®ËÆæÁΩÆ‰∏≠Â°´ÂÜô API Key','error'); return; }
  document.getElementById('etySearchInput').value = word;
  switchEtyView('search');

  // 1. Check cache first
  const cached = etymologyWords.find(w => w.word.toLowerCase() === word.toLowerCase());
  if (cached) {
    etyAnalysis = cached;
    renderEtyResult(document.getElementById('etySearchView'));
    showToast('‰ªéÁºìÂ≠òÂä†ËΩΩ ‚úì','success');
    updateEtySearchHistory(word);
    return;
  }

  // 2. Call API
  etyAnalysis = null;
  const el = document.getElementById('etySearchView');
  el.innerHTML = '<div style="text-align:center;padding:40px"><div class="spinner spinner-dark" style="width:28px;height:28px;border-width:3px"></div><p style="margin-top:12px;color:var(--text-muted);font-size:14px">Ê≠£Âú®ÂàÜÊûê ' + esc(word) + ' ...</p></div>';
  const btn = document.getElementById('etySearchBtn');
  btn.disabled = true;
  try {
    const result = await callAI(buildEtymologyPrompt(word));
    etyAnalysis = result;
    // 3. Auto-save to cache
    await saveEtyWord({ ...result, savedAt: Date.now() });
    updateEtySearchHistory(word);
    renderEtyResult(el);
    showToast('Â∑≤Ëá™Âä®ÁºìÂ≠ò','success');
  } catch(e) {
    el.innerHTML = `<div class="empty-state"><div class="empty-state-icon">üò•</div><p class="empty-state-desc">ÂàÜÊûêÂ§±Ë¥•: ${esc(e.message)}</p></div>`;
  }
  btn.disabled = false;
}

function updateEtySearchHistory(word) {
  let history = JSON.parse(localStorage.getItem('ety_search_history') || '[]');
  history = [word, ...history.filter(w => w.toLowerCase() !== word.toLowerCase())].slice(0, 15);
  localStorage.setItem('ety_search_history', JSON.stringify(history));
}

async function saveEtyWordFromAnalysis() {
  if (!etyAnalysis) return;
  if (!etymologyWords.some(w => w.word === etyAnalysis.word)) {
    await saveEtyWord({ ...etyAnalysis, savedAt:Date.now() });
    showToast('Â∑≤Êî∂ËóèÂà∞ËØçÂ∫ì','success');
  }
  renderEtySearchView();
}

// --- Explore View ---
function renderEtyExploreView() {
  const el = document.getElementById('etyExploreView');
  el.innerHTML = `
    <h3 style="font-size:16px;font-weight:600;color:var(--text-primary);margin-bottom:16px">ÊåâÈ¢ÜÂüüÊé¢Á¥¢‰∏ì‰∏öËØçÊ±á</h3>
    <div class="cat-grid">${EXPLORE_CATEGORIES.map(c=>{
      const cached = c.keywords.filter(w => etymologyWords.some(ew => ew.word.toLowerCase() === w.toLowerCase())).length;
      return `<div class="cat-card" onclick="showCategoryWords('${c.id}')">
        <div class="cat-icon">${c.icon}</div>
        <div class="cat-name">${c.name}</div>
        <div class="cat-count">${cached}/${c.keywords.length} Â∑≤Â≠¶</div>
        ${cached>0?`<div style="width:100%;height:3px;background:var(--warm-gray);border-radius:2px;margin-top:4px"><div style="width:${Math.round(cached/c.keywords.length*100)}%;height:100%;background:var(--accent);border-radius:2px"></div></div>`:''}
      </div>`;
    }).join('')}
    </div>
    <div id="categoryWordList"></div>`;
}

function showCategoryWords(catId) {
  const cat = EXPLORE_CATEGORIES.find(c=>c.id===catId);
  if (!cat) return;
  const cachedCount = cat.keywords.filter(w => etymologyWords.some(ew => ew.word.toLowerCase() === w.toLowerCase())).length;
  document.getElementById('categoryWordList').innerHTML = `
    <h3 style="font-size:16px;font-weight:600;color:var(--text-primary);margin:16px 0 8px">${cat.icon} ${cat.name}</h3>
    <p style="font-size:12px;color:var(--text-muted);margin-bottom:12px">Â∑≤Â≠¶‰π† ${cachedCount}/${cat.keywords.length} ËØç</p>
    <div class="word-list">${cat.keywords.map(w=>{
      const isCached = etymologyWords.some(ew => ew.word.toLowerCase() === w.toLowerCase());
      return `<div class="word-list-item" style="${isCached?'background:rgba(76,175,80,0.05)':''}"><span style="flex:1;cursor:pointer" onclick="etySearchWord('${w}')">${w} ${isCached?'<span style=font-size:10px;color:var(--success)>‚úì</span>':''}</span><button class="speak-btn" style="width:28px;height:28px;font-size:12px;flex-shrink:0" onclick="event.stopPropagation();speakWord('${w}')">üîä</button><span style="cursor:pointer;color:var(--text-muted)" onclick="etySearchWord('${w}')">‚Üí</span></div>`;
    }).join('')}
    </div>`;
}

// --- Course View ---
function renderEtyCourseView() {
  const el = document.getElementById('etyCourseView');
  if (currentCourseUnit) { renderCourseUnit(el); return; }
  el.innerHTML = `
    <h3 style="font-size:16px;font-weight:600;color:var(--text-primary);margin-bottom:16px">Á≥ªÁªüËØæÁ®ã ¬∑ ÁõÆÊ†áÊéåÊè°10000ËØç</h3>
    <div class="level-tabs">${Object.keys(COURSE_DATA).map(l=>`<button class="level-tab ${currentCourseLevel===l?'active':''}" onclick="currentCourseLevel='${l}';renderEtyCourseView()">${COURSE_DATA[l].title.split('Ôºö')[0]}</button>`).join('')}</div>
    <p style="font-size:13px;color:var(--text-muted);margin-bottom:16px">${COURSE_DATA[currentCourseLevel].description}</p>
    <div class="unit-grid">${COURSE_DATA[currentCourseLevel].units.map((u,i)=>`
      <div class="unit-card">
        <div class="unit-header"><span class="unit-number">Unit ${i+1}</span></div>
        <div class="unit-title">${u.title}</div>
        <div class="unit-subtitle">${u.subtitle}</div>
        <div class="unit-stats"><span>${u.rootCount} ËØçÊ†π</span><span>${u.wordCount}+ ÂçïËØç</span></div>
        <div class="unit-actions">
          <button class="btn btn-primary btn-small" onclick="currentCourseUnit=COURSE_DATA['${currentCourseLevel}'].units[${i}];renderEtyCourseView()">Â≠¶‰π†</button>
        </div>
      </div>`).join('')}</div>`;
}

function renderCourseUnit(el) {
  const u = currentCourseUnit;
  const cachedCount = u.words.filter(w => etymologyWords.some(ew => ew.word.toLowerCase() === w.toLowerCase())).length;
  el.innerHTML = `
    <button class="btn btn-secondary btn-small" onclick="currentCourseUnit=null;renderEtyCourseView()" style="margin-bottom:16px">‚Üê ËøîÂõûËØæÁ®ã</button>
    <h3 style="font-size:20px;font-weight:600;color:var(--text-primary);margin-bottom:4px">${u.title}</h3>
    <p style="font-size:12px;color:var(--text-muted);margin-bottom:16px">Â∑≤Â≠¶‰π† ${cachedCount}/${u.words.length} ËØç</p>
    <div class="ety-card"><div class="ety-card-title">üìå Ê†∏ÂøÉËØçÊ†π</div>
      <div style="display:flex;flex-wrap:wrap;gap:8px">${u.roots.map(r=>`<span class="article-root-tag" style="cursor:pointer" onclick="speakWord('${r.split('(')[0].replace(/[-\s]/g,'')}')">${r} üîä</span>`).join('')}</div></div>
    <div class="ety-card"><div class="ety-card-title">üìù ‰æãËØçÂàóË°®</div>
      <div class="word-list">${u.words.map(w=>{
        const isCached = etymologyWords.some(ew => ew.word.toLowerCase() === w.toLowerCase());
        return `<div class="word-list-item" style="${isCached?'background:rgba(76,175,80,0.05)':''}"><span style="flex:1;cursor:pointer" onclick="etySearchWord('${w}')">${w} ${isCached?'<span style=font-size:10px;color:var(--success)>‚úì</span>':''}</span><button class="speak-btn" style="width:28px;height:28px;font-size:12px;flex-shrink:0" onclick="event.stopPropagation();speakWord('${w}')">üîä</button><span style="cursor:pointer;color:var(--text-muted)" onclick="etySearchWord('${w}')">‚Üí</span></div>`;
      }).join('')}</div></div>`;
}

// ======================================================================
// REVIEW TAB (TAB 3) - Spaced Repetition System
// ======================================================================
// Intervals: Level 0=new, 1=1day, 2=3days, 3=7days, 4=15days, 5=30days(mastered)

function getAllReviewableWords() {
  const wordMap = new Map();
  cards.forEach(card => card.keywords?.forEach(kw => {
    const key = kw.word.toLowerCase();
    if (!wordMap.has(key)) wordMap.set(key, { word:kw.word, phonetic:kw.phonetic, meaning:kw.meaning, roots:kw.roots, origin:kw.origin, example:card.content, source:'collection' });
  }));
  etymologyWords.forEach(ew => {
    const key = ew.word.toLowerCase();
    if (!wordMap.has(key)) wordMap.set(key, { word:ew.word, phonetic:ew.phonetic, meaning:ew.meaning, roots:ew.roots?.map(r=>r.part+' ‚Üí '+r.meaning).join(', '), origin:ew.etymology_story||'', example:ew.examples?.[0]?.sentence||'', source:'etymology' });
  });
  return wordMap;
}

function updateReviewStats() {
  const wordMap = getAllReviewableWords();
  const now = Date.now();
  let dueCount = 0, newCount = 0, masteredCount = 0;
  wordMap.forEach((_, key) => {
    const rec = reviewRecords[key];
    if (!rec) { newCount++; }
    else if (rec.level >= 5) { masteredCount++; }
    else if (rec.nextReview <= now) { dueCount++; }
  });
  document.getElementById('reviewDueCount').textContent = dueCount;
  document.getElementById('reviewNewCount').textContent = newCount;
  document.getElementById('reviewMasteredCount').textContent = masteredCount;
  document.getElementById('reviewTotalCount').textContent = wordMap.size;
}

function initReview() {
  document.getElementById('reviewSummary').classList.add('hide');
  document.getElementById('reviewHistoryPanel').classList.add('hide');
  const wordMap = getAllReviewableWords();
  const now = Date.now();
  
  // Categorize words
  const dueWords = [], newWords = [], allWords = [];
  wordMap.forEach((data, key) => {
    const rec = reviewRecords[key];
    const item = { ...data, wordKey: key };
    allWords.push(item);
    if (!rec) { newWords.push(item); }
    else if (rec.level < 5 && rec.nextReview <= now) { dueWords.push(item); }
  });
  
  // Priority: due words first, then some new words, max 20
  let sessionWords = [];
  // Shuffle due words and take all
  dueWords.sort(() => Math.random() - 0.5);
  sessionWords.push(...dueWords);
  // Fill remaining slots with new words
  const remaining = Math.max(0, 20 - sessionWords.length);
  newWords.sort(() => Math.random() - 0.5);
  sessionWords.push(...newWords.slice(0, remaining));
  // Cap at 20
  sessionWords = sessionWords.slice(0, 20);
  
  if (sessionWords.length === 0 && allWords.length > 0) {
    // No due words, show review-complete message
    document.getElementById('reviewContent').classList.add('hide');
    document.getElementById('reviewEmpty').classList.add('hide');
    document.getElementById('reviewSummary').classList.remove('hide');
    document.getElementById('summaryEmoji').textContent = '‚úÖ';
    document.getElementById('summaryTitle').textContent = '‰ªäÊó•Â§ç‰π†Â∑≤ÂÆåÊàê';
    document.getElementById('summaryText').textContent = `ÊâÄÊúâÂæÖÂ§ç‰π†ÁöÑËØçÊ±áÈÉΩÂ∑≤Â§ç‰π†ÂÆåÊØï„ÄÇÊñ∞ËØç ${newWords.length > 0 ? '‰πüÊ≤°Êúâ‰∫Ü' : '‰ºöÂú®Êî∂ËóèÂêéËá™Âä®Âä†ÂÖ•'}„ÄÇ`;
    updateReviewStats();
    return;
  }
  
  if (sessionWords.length === 0) {
    document.getElementById('reviewContent').classList.add('hide');
    document.getElementById('reviewEmpty').classList.remove('hide');
    updateReviewStats();
    return;
  }
  
  document.getElementById('reviewContent').classList.remove('hide');
  document.getElementById('reviewEmpty').classList.add('hide');
  reviewState.words = sessionWords;
  reviewState.currentIndex = 0;
  reviewState.results = [];
  showCurrentWord();
  updateReviewStats();
}

function showCurrentWord() {
  const w = reviewState.words[reviewState.currentIndex];
  if (!w) return;
  const rec = reviewRecords[w.wordKey];
  const levelLabel = rec ? `Lv.${rec.level}` : 'Êñ∞ËØç';
  document.getElementById('reviewProgress').textContent = `${reviewState.currentIndex+1} / ${reviewState.words.length}„ÄÄ${levelLabel}`;
  document.getElementById('flashcardWord').textContent = w.word;
  document.getElementById('flashcardPhonetic').textContent = w.phonetic||'';
  document.getElementById('flashcardBack').innerHTML = `
    <div class="flashcard-back-word">${esc(w.word)}</div>
    <div class="flashcard-back-meaning">${esc(w.meaning||'')}</div>
    <div class="flashcard-back-detail"><span>ÊûÑËØç:</span> ${esc(w.roots||'-')}<br><span>Êù•Ê∫ê:</span> ${esc(w.origin||'-')}<br><span>‰æãÂè•:</span> ${esc(w.example||'')}</div>`;
  document.getElementById('flashcard').classList.remove('flipped');
}

function flipCard() { document.getElementById('flashcard').classList.toggle('flipped'); }

async function markCard(known) {
  const w = reviewState.words[reviewState.currentIndex];
  if (!w) return;
  
  // Update review record
  const now = Date.now();
  let rec = reviewRecords[w.wordKey] || { wordKey: w.wordKey, word: w.word, level: 0, nextReview: now, reviewCount: 0, correctCount: 0, wrongCount: 0, lastReview: 0 };
  
  rec.reviewCount++;
  rec.lastReview = now;
  
  if (known) {
    rec.correctCount++;
    rec.level = Math.min(5, rec.level + 1);
  } else {
    rec.wrongCount++;
    rec.level = Math.max(1, Math.min(rec.level, 1)); // Reset to level 1 on wrong
  }
  
  // Calculate next review time based on new level
  const intervalDays = REVIEW_INTERVALS[rec.level] || 1;
  rec.nextReview = now + intervalDays * 86400000;
  
  // Save to IndexedDB and memory
  reviewRecords[w.wordKey] = rec;
  await dbPut('reviewRecords', rec);
  
  // Track result
  reviewState.results.push({ word: w.word, known, newLevel: rec.level });
  reviewState.currentIndex++;
  
  if (reviewState.currentIndex >= reviewState.words.length) {
    // Session complete - show summary
    const correctCount = reviewState.results.filter(r => r.known).length;
    const total = reviewState.results.length;
    
    document.getElementById('reviewContent').classList.add('hide');
    document.getElementById('reviewSummary').classList.remove('hide');
    
    const ratio = correctCount / total;
    document.getElementById('summaryEmoji').textContent = ratio >= 0.8 ? 'üéâ' : ratio >= 0.5 ? 'üëç' : 'üí™';
    document.getElementById('summaryTitle').textContent = ratio >= 0.8 ? 'Â§™Ê£í‰∫ÜÔºÅ' : ratio >= 0.5 ? 'ÁªßÁª≠Âä†Ê≤πÔºÅ' : 'ÂÜçÁªÉÁªÉÂ∞±Â•Ω‰∫ÜÔºÅ';
    document.getElementById('summaryText').textContent = `Êú¨Ê¨°Â§ç‰π† ${total} ËØçÔºåËÆ§ËØÜ ${correctCount} ‰∏™ÔºåÊ≠£Á°ÆÁéá ${Math.round(ratio*100)}%`;
    
    updateReviewStats();
  } else {
    showCurrentWord();
  }
}

function showReviewHistory() {
  document.getElementById('reviewSummary').classList.add('hide');
  document.getElementById('reviewContent').classList.add('hide');
  document.getElementById('reviewStats').style.display = 'none';
  document.getElementById('reviewHistoryPanel').classList.remove('hide');
  
  const levelNames = ['Êñ∞ËØç', 'ÂàùÂ≠¶ (1Â§©)', 'ÁÜüÊÇâ (3Â§©)', 'ÁêÜËß£ (7Â§©)', 'Â∑©Âõ∫ (15Â§©)', 'Â∑≤ÊéåÊè° ‚úì'];
  const entries = Object.values(reviewRecords).sort((a,b) => b.lastReview - a.lastReview);
  
  if (entries.length === 0) {
    document.getElementById('reviewHistoryList').innerHTML = '<p style="text-align:center;color:var(--text-muted);padding:40px 0">ËøòÊ≤°ÊúâÂ§ç‰π†ËÆ∞ÂΩï</p>';
    return;
  }
  
  document.getElementById('reviewHistoryList').innerHTML = entries.map(r => `
    <div class="review-history-item">
      <span class="review-history-word">${esc(r.word)}</span>
      <button class="speak-btn" style="width:28px;height:28px;font-size:12px" onclick="speakWord('${esc(r.word)}')">üîä</button>
      <span class="review-level-badge review-level-${r.level}">${levelNames[r.level]||'Lv.'+r.level}</span>
      <span style="font-size:11px;color:var(--text-muted)">${r.correctCount}‚úì ${r.wrongCount}‚úó</span>
    </div>`).join('');
}

function closeReviewHistory() {
  document.getElementById('reviewHistoryPanel').classList.add('hide');
  document.getElementById('reviewStats').style.display = '';
  initReview();
}

// ======================================================================
// SETTINGS (TAB 4)
// ======================================================================
function onProviderChange() {
  settings.apiProvider = document.getElementById('apiProvider').value;
  updateModelOptions();
  saveSettings();
}

function saveSettings() {
  settings.apiProvider = document.getElementById('apiProvider').value;
  settings.apiModel = document.getElementById('apiModel').value;
  settings.apiKey = document.getElementById('apiKey').value;
  saveSettingsToDB();
}

function updateModelOptions() {
  const models = {
    gemini: [{ v:'gemini-2.5-flash', l:'Gemini 2.5 Flash' }, { v:'gemini-2.0-flash', l:'Gemini 2.0 Flash' }],
    openrouter: [{ v:'anthropic/claude-sonnet-4', l:'Claude Sonnet 4' }, { v:'anthropic/claude-haiku-4.5', l:'Claude Haiku 4.5Ôºà‰æøÂÆúÔºâ' }],
    deepseek: [{ v:'deepseek-chat', l:'DeepSeek Chat' }]
  };
  const sel = document.getElementById('apiModel');
  const opts = models[settings.apiProvider]||[];
  sel.innerHTML = opts.map(m=>`<option value="${m.v}">${m.l}</option>`).join('');
  // Try to restore saved model
  if (opts.some(m=>m.v===settings.apiModel)) sel.value = settings.apiModel;
  else if (opts.length) { settings.apiModel = opts[0].v; sel.value = settings.apiModel; }
}

function updateStats() {
  document.getElementById('statTotal').textContent = cards.length;
  const words = new Set();
  cards.forEach(c=>c.keywords?.forEach(k=>words.add(k.word.toLowerCase())));
  etymologyWords.forEach(w=>words.add(w.word.toLowerCase()));
  document.getElementById('statWords').textContent = words.size;
  document.getElementById('statEtyCount').textContent = etymologyWords.length;
  if (settings.firstUseDate) document.getElementById('statDays').textContent = Math.ceil((new Date()-new Date(settings.firstUseDate))/86400000);
}

// ======================================================================
// AI API
// ======================================================================
function buildCollectionPrompt(content) {
  return `ÂàÜÊûê‰ª•‰∏ãËã±ÊñáÂÜÖÂÆπÔºåËøîÂõûJSONÊ†ºÂºèÔºà‰∏çË¶Åmarkdown‰ª£Á†ÅÂùóÔºâÔºö

ÂÜÖÂÆπÔºö"${content}"

Ë¶ÅÊ±ÇÔºö
1. translation: ‰∏≠ÊñáÁøªËØë
2. keywords: Êï∞ÁªÑÔºåÊúÄÂ§ö5‰∏™ÈáçÁÇπËØçÊ±áÔºà‰∏çË¶ÅÈÄâ the, is, a Á≠âÁÆÄÂçïËØçÔºâÔºåÊØè‰∏™ÂåÖÂê´Ôºö
   - word: ÂçïËØç
   - phonetic: Èü≥Ê†á
   - roots: ËØçÊ†πÊûÑÊàê
   - origin: ËØçÊ∫ê
   - meaning: ‰∏≠ÊñáÈáä‰πâ

ËøîÂõûÊ†ºÂºèÔºö{"translation":"...","keywords":[{"word":"...","phonetic":"...","roots":"...","origin":"...","meaning":"..."}]}`;
}

function buildEtymologyPrompt(word) {
  return `‰Ωú‰∏∫ËØçÊ∫êÂ≠¶‰∏ìÂÆ∂ÔºåËØ∑ÂàÜÊûêÂçïËØç "${word}" ÁöÑËØçÊ†πËØçÊ∫ê„ÄÇËØ∑Áî®‰ª•‰∏ãJSONÊ†ºÂºèËøîÂõûÔºà‰∏çË¶Åmarkdown‰ª£Á†ÅÂùóÔºåÁõ¥Êé•ËøîÂõûJSONÔºâÔºö
{
  "word": "ÂçïËØç",
  "phonetic": "Èü≥Ê†á",
  "meaning": "Ê†∏ÂøÉÂê´‰πâÔºàÁÆÄÊ¥Å‰∏≠ÊñáÔºâ",
  "roots": [
    { "part": "ËØçÊ†π/ËØçÁºÄÈÉ®ÂàÜ", "origin": "Êù•Ê∫êËØ≠Ë®Ä", "originalWord": "ÂéüÂßãËØç", "meaning": "ËØ•ÈÉ®ÂàÜÂê´‰πâ" }
  ],
  "etymology_story": "Áî®ÁîüÂä®ÊúâË∂£ÁöÑÊñπÂºèËÆ≤Ëß£Ëøô‰∏™ËØçÁöÑÊù•Ê∫êÊïÖ‰∫ãÔºå150Â≠ó‰ª•ÂÜÖ",
  "memory_tip": "‰∏ÄÂè•ËØùËÆ∞ÂøÜÊäÄÂ∑ß",
  "examples": [
    { "sentence": "Ëã±Êñá‰æãÂè•", "translation": "‰∏≠ÊñáÁøªËØë" },
    { "sentence": "Ëã±Êñá‰æãÂè•2", "translation": "‰∏≠ÊñáÁøªËØë2" }
  ],
  "related_words": ["Áõ∏ÂÖ≥ËØç1", "Áõ∏ÂÖ≥ËØç2", "Áõ∏ÂÖ≥ËØç3"]
}`;
}

async function callAI(prompt) {
  const res = await fetch('/api/analyze', {
    method: 'POST', headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ provider:settings.apiProvider, model:settings.apiModel, apiKey:settings.apiKey, prompt })
  });
  if (!res.ok) { const e = await res.json(); throw new Error(e.message || 'API failed'); }
  return await res.json();
}

// ======================================================================
// EXPORT / IMPORT
// ======================================================================
function exportJSON() {
  const allReviewRecs = Object.values(reviewRecords);
  downloadFile(JSON.stringify({ version:'2.1.0', exportDate:new Date().toISOString(), cards, etymologyWords, reviewRecords:allReviewRecs, settings:{...settings,apiKey:''} }, null, 2), 'english-collector-backup.json', 'application/json');
  showToast('Â§á‰ªΩÂ∑≤ÂØºÂá∫','success');
}

function importJSON(event) {
  const file = event.target.files[0]; if (!file) return;
  const reader = new FileReader();
  reader.onload = async (e) => {
    try {
      const data = JSON.parse(e.target.result);
      if (data.cards?.length) for (const c of data.cards) await saveCardToDB(c);
      if (data.etymologyWords?.length) for (const w of data.etymologyWords) await saveEtyWord(w);
      cards = await dbGetAll('cards'); cards.sort((a,b)=>new Date(b.createdAt)-new Date(a.createdAt));
      etymologyWords = await dbGetAll('etymologyWords');
      renderCards(); updateStats();
      showToast(`Â∑≤ÂØºÂÖ• ${data.cards?.length||0} Êù°Êî∂Ëóè + ${data.etymologyWords?.length||0} ‰∏™ËØçÊ±á`,'success');
    } catch(err) { showToast('ÂØºÂÖ•Â§±Ë¥•: '+err.message,'error'); }
  };
  reader.readAsText(file); event.target.value='';
}

function exportAnki() {
  const exported = new Set(); let csv = '';
  cards.forEach(c=>c.keywords?.forEach(k=>{
    if (!exported.has(k.word.toLowerCase())) { exported.add(k.word.toLowerCase()); csv += `${escCSV(k.word)}\t${escCSV(`${k.phonetic||''}\n${k.meaning}\nËØçÊ†π: ${k.roots||'-'}\nÊù•Ê∫ê: ${k.origin||'-'}\n‰æãÂè•: ${c.content}`)}\n`; }
  }));
  etymologyWords.forEach(w=>{
    if (!exported.has(w.word.toLowerCase())) { exported.add(w.word.toLowerCase()); csv += `${escCSV(w.word)}\t${escCSV(`${w.phonetic||''}\n${w.meaning}\n${w.memory_tip||''}`)}\n`; }
  });
  if (!csv) { showToast('Ê≤°ÊúâÂÜÖÂÆπ','error'); return; }
  downloadFile(csv, `anki-words-${Date.now()}.txt`, 'text/plain');
  showToast('Â∑≤ÂØºÂá∫','success');
}

function exportSingleAnki(cardId) {
  const card = cards.find(c=>c.id===cardId); if (!card) return;
  let csv = '';
  card.keywords?.forEach(k=>{ csv += `${escCSV(k.word)}\t${escCSV(`${k.phonetic||''}\n${k.meaning}\nËØçÊ†π: ${k.roots||'-'}\nÊù•Ê∫ê: ${k.origin||'-'}\n‰æãÂè•: ${card.content}`)}\n`; });
  downloadFile(csv, `anki-${Date.now()}.txt`, 'text/plain');
  showToast('Â∑≤ÂØºÂá∫','success');
}

// ======================================================================
// URL IMPORT (from Chrome extension)
// ======================================================================
async function checkUrlImport() {
  const params = new URLSearchParams(window.location.search);
  const importData = params.get('import');
  if (importData) {
    try {
      const card = JSON.parse(decodeURIComponent(atob(importData)));
      await saveCardToDB(card);
      if (!settings.firstUseDate) { settings.firstUseDate=new Date().toISOString(); await saveSettingsToDB(); }
      window.history.replaceState({}, '', location.pathname);
      renderCards(); updateStats(); showToast('Â∑≤ÂØºÂÖ•ÔºÅ','success');
      if (settings.autoSync && accessToken) syncToCloud();
    } catch(e) { console.error('Import error:', e); }
  }
}

// ======================================================================
// UTILS
// ======================================================================
function showToast(msg, type='') {
  const t = document.getElementById('toast'); t.textContent=msg; t.className='toast '+type; t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'), 3000);
}
function esc(text) { if (!text) return ''; const d=document.createElement('div'); d.textContent=text; return d.innerHTML; }
function escCSV(text) { return (text||'').replace(/"/g,'""').replace(/\n/g,'<br>'); }
function downloadFile(content, filename, type) {
  const a = document.createElement('a'); a.href=URL.createObjectURL(new Blob([content],{type})); a.download=filename; a.click();
}

// ======================================================================
// INIT
// ======================================================================
async function init() {
  showWelcome();
  try {
    window.speechSynthesis.getVoices();
    try {
      await initDB();
    } catch(dbErr) {
      console.error('DB init failed, retrying...', dbErr);
      // If blocked, try deleting and recreating
      await new Promise(r => setTimeout(r, 1000));
      try { await initDB(); } catch(e2) {
        console.error('DB retry failed:', e2);
        showToast('Êï∞ÊçÆÂ∫ìÂàùÂßãÂåñÂ§±Ë¥•ÔºåËØ∑ÂÖ≥Èó≠ÂÖ∂‰ªñÊ†áÁ≠æÈ°µÂêéÂà∑Êñ∞', 'error');
        return;
      }
    }
    await loadData();
    // Restore Google session
    const savedToken = localStorage.getItem('ec_access_token');
    const savedUser = localStorage.getItem('ec_user');
    if (savedToken && savedUser) { accessToken=savedToken; googleUser=JSON.parse(savedUser); updateUserUI(); fetchUserInfo(); }
    await checkUrlImport();
    renderCards(); updateStats();
    if (settings.autoSync && accessToken && cards.length > 0) setTimeout(()=>syncToCloud(), 2000);
  } catch(e) { console.error('Init error:', e); showToast('ÂàùÂßãÂåñÂ§±Ë¥•: '+e.message,'error'); }
}
init();
</script>
</body>
</html>
